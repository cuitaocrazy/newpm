# ============================
# Tab 1: 基本信息
# ============================
basicInfo:
  tableName: pm_customer
  tableComment: 客户信息表
  className: Customer
  functionAuthor: ruoyi
  remark: ""

# ============================
# Tab 2: 字段信息
# ============================
columns:
  customer_id:
    columnComment: 客户主键ID
    columnType: bigint
    javaType: Long
    javaField: customerId
    isInsert: true
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  customer_simple_name:
    columnComment: 客户简称
    columnType: varchar(200)
    javaType: String
    javaField: customerSimpleName
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: LIKE
    isRequired: true
    htmlType: input
    dictType: ""

  customer_all_name:
    columnComment: 客户全称
    columnType: varchar(200)
    javaType: String
    javaField: customerAllName
    isInsert: true
    isEdit: true
    isList: true
    isQuery: false
    queryType: LIKE
    isRequired: true
    htmlType: input
    dictType: ""

  industry:
    columnComment: 所属行业
    columnType: varchar(100)
    javaType: String
    javaField: industry
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: EQ
    isRequired: false
    htmlType: select
    dictType: "industry"

  region:
    columnComment: 所属区域
    columnType: varchar(100)
    javaType: String
    javaField: region
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: EQ
    isRequired: false
    htmlType: select
    dictType: "sys_yjqy"

  sales_manager_id:
    columnComment: 销售负责人ID
    columnType: bigint
    javaType: Long
    javaField: salesManagerId
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: EQ
    isRequired: false
    htmlType: select
    dictType: ""

  office_address:
    columnComment: 办公地址
    columnType: varchar(500)
    javaType: String
    javaField: officeAddress
    isInsert: true
    isEdit: true
    isList: true
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: textarea
    dictType: ""

  del_flag:
    columnComment: 删除标志(0正常 1删除)
    columnType: char(1)
    javaType: String
    javaField: delFlag
    isInsert: true
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  create_by:
    columnComment: 创建者
    columnType: varchar(64)
    javaType: String
    javaField: createBy
    isInsert: true
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  create_time:
    columnComment: 创建时间
    columnType: datetime
    javaType: Date
    javaField: createTime
    isInsert: true
    isEdit: false
    isList: true
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: datetime
    dictType: ""

  update_by:
    columnComment: 更新者
    columnType: varchar(64)
    javaType: String
    javaField: updateBy
    isInsert: false
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  update_time:
    columnComment: 更新时间
    columnType: datetime
    javaType: Date
    javaField: updateTime
    isInsert: false
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: datetime
    dictType: ""

  remark:
    columnComment: 备注
    columnType: varchar(500)
    javaType: String
    javaField: remark
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: textarea
    dictType: ""

# ============================
# Tab 3: 生成信息
# ============================
genInfo:
  tplCategory: sub
  tplWebType: element-plus
  packageName: com.ruoyi.project
  moduleName: project
  businessName: customer
  functionName: 客户信息
  parentMenuId: 3
  subTableName: pm_customer_contact
  subTableFkName: customer_id
  subTableGenerateMenu: false

# ============================
# 子表字段信息（仅 tplCategory=sub 时需要）
# ============================
subTableColumns:
  contact_id:
    columnComment: 联系人主键ID
    columnType: bigint
    javaType: Long
    javaField: contactId
    isPk: "1"
    isInsert: true
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""
  customer_id:
    columnComment: 客户ID
    columnType: bigint
    javaType: Long
    javaField: customerId
    isPk: "0"
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: EQ
    isRequired: true
    htmlType: input
    dictType: ""
  contact_name:
    columnComment: 联系人姓名
    columnType: varchar(100)
    javaType: String
    javaField: contactName
    isPk: "0"
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: LIKE
    isRequired: true
    htmlType: input
    dictType: ""
  contact_phone:
    columnComment: 联系人电话
    columnType: varchar(50)
    javaType: String
    javaField: contactPhone
    isPk: "0"
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: EQ
    isRequired: true
    htmlType: input
    dictType: ""
  contact_tag:
    columnComment: 联系人标签
    columnType: varchar(100)
    javaType: String
    javaField: contactTag
    isPk: "0"
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: EQ
    isRequired: true
    htmlType: select
    dictType: "contact_tag"
  del_flag:
    columnComment: 删除标志(0正常 1删除)
    columnType: char(1)
    javaType: String
    javaField: delFlag
    isPk: "0"
    isInsert: true
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""
  create_by:
    columnComment: 创建者
    columnType: varchar(64)
    javaType: String
    javaField: createBy
    isPk: "0"
    isInsert: true
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""
  create_time:
    columnComment: 创建时间
    columnType: datetime
    javaType: Date
    javaField: createTime
    isPk: "0"
    isInsert: true
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: datetime
    dictType: ""
  update_by:
    columnComment: 更新者
    columnType: varchar(64)
    javaType: String
    javaField: updateBy
    isPk: "0"
    isInsert: false
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""
  update_time:
    columnComment: 更新时间
    columnType: datetime
    javaType: Date
    javaField: updateTime
    isPk: "0"
    isInsert: false
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: datetime
    dictType: ""
  remark:
    columnComment: 备注
    columnType: varchar(500)
    javaType: String
    javaField: remark
    isPk: "0"
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: textarea
    dictType: ""

# ============================
# 定制需求（超出标准模板的组件/交互/接口需求）
# ============================
customizations:
  # 1. 客户简称自动补全查询
  customer_name_autocomplete:
    intent: "客户简称查询，使用 autocomplete 自动补全，支持模糊搜索"
    component:
      type: el-autocomplete
      props:
        fetchSuggestions: "前端过滤或后端搜索"
        valueKey: "customerSimpleName"
        placeholder: "请输入客户简称"
        clearable: true
    bindTo: customer_simple_name
    service:
      endpoint: "GET /project/customer/list?customerSimpleName={keyword}"
      source: "复用现有 list 接口"
      returns: "[{ customerId, customerSimpleName }]"
      newApi: false
    notes: "查询表单中的客户简称字段使用 autocomplete 组件"

  # 2. 销售负责人数据源
  sales_manager_data:
    intent: "销售负责人数据源，通过岗位编码xsfzr筛选用户，显示用户昵称"
    component:
      type: el-select
      props:
        filterable: true
        clearable: true
        placeholder: "请选择销售负责人"
        valueKey: "userId"
        labelKey: "nickName"
    bindTo: sales_manager_id
    service:
      endpoint: "GET /system/user/listByPostCode?postCode=xsfzr"
      source: "新增接口到 ruoyi-admin 模块的 SysUserController"
      returns: "List<SysUser> - 完整的用户对象列表（包含 userId, userName, nickName 等）"
      newApi: true
    notes: |
      后端实现：
      1. Controller: SysUserController 新增方法 listByPostCode(String postCode)
      2. Service: ISysUserService 新增方法 selectUserListByPostCode(String postCode)
      3. Mapper: SysUserMapper 新增 SQL，关联查询：
         SELECT u.* FROM sys_user u
         INNER JOIN sys_user_post up ON u.user_id = up.user_id
         INNER JOIN sys_post p ON up.post_id = p.post_id
         WHERE p.post_code = #{postCode} AND u.del_flag = '0'

  # 3. 销售负责人显示（列表和Excel导出）
  sales_manager_display:
    intent: "列表和Excel导出时，销售负责人显示用户昵称而非ID"
    component:
      type: custom
      spec: |
        列表显示：通过前端映射 userId -> nickName
        Excel导出：通过 SQL 关联查询获取昵称
    bindTo: sales_manager_id
    service:
      endpoint: "GET /system/user/listByPost?postCode=xsfzr"
      source: "复用 listUserByPost 接口，前端建立映射表"
      returns: "Map<userId, nickName>"
      newApi: false
    notes: |
      前端实现（列表显示）：
      1. 页面加载时调用 listUserByPost('xsfzr') 接口获取销售负责人列表
      2. 建立映射：const salesManagerMap = users.reduce((map, user) => {
           map[user.userId] = user.nickName
           return map
         }, {})
      3. 列表中使用：{{ salesManagerMap[row.salesManagerId] || '-' }}

      后端实现（Excel导出）：
      1. Customer 实体类添加字段：
         private Long salesManagerId;  // 保留ID字段，但不导出

         @Excel(name = "销售负责人")
         private String salesManagerName;  // 新增名称字段用于导出

      2. CustomerMapper.xml 的 selectCustomerVo 修改为关联查询：
         <sql id="selectCustomerVo">
           select c.customer_id, c.customer_simple_name, c.customer_all_name, c.industry, c.region,
                  c.sales_manager_id, u.nick_name as sales_manager_name, c.office_address, c.del_flag,
                  c.create_by, c.create_time, c.update_by, c.update_time, c.remark
           from pm_customer c
           left join sys_user u on c.sales_manager_id = u.user_id
         </sql>

      3. resultMap 添加映射：
         <result property="salesManagerName" column="sales_manager_name" />

      4. selectCustomerList 和 selectCustomerByCustomerId 都使用关联查询

  # 4. 字典字段显示（列表和Excel导出）
  dict_fields_display:
    intent: "列表和Excel导出时，字典字段显示字典标签而非编码"
    component:
      type: custom
      spec: |
        字典字段：industry（所属行业）、region（所属区域）
        列表显示：使用 DictTag 组件
        Excel导出：使用 @Excel 注解的 dictType 属性自动转换
    bindTo: ["industry", "region"]
    service: null
    notes: |
      实体类配置：
      @Excel(name = "所属行业", dictType = "industry")
      private String industry;

      @Excel(name = "所属区域", dictType = "sys_yjqy")
      private String region;

      说明：
      - dictType 属性会自动将字典编码转换为字典标签
      - 例如：NH -> 能源行业，HBQY -> 华北区域
      - 无需额外代码，RuoYi 框架自动处理      @Excel(name = "所属区域", dictType = "sys_yjqy")
      private String region;

  # 5. 普通文本字段直接显示
  plain_text_display:
    intent: "客户简称、客户全称、办公地址、备注等普通文本字段直接显示，不使用字典标签组件"
    component:
      type: custom
      spec: "列表中直接显示文本内容，不包裹任何组件"
    bindTo: ["customer_simple_name", "customer_all_name", "office_address", "remark"]
    service: null
    notes: "列表显示直接使用 {{ scope.row.xxx }}"

  # 6. 删除系统字段输入框
  remove_system_fields:
    intent: "删除表单中的 del_flag、create_by、create_time、update_by、update_time 输入框，系统字段不应让用户手动输入"
    component:
      type: custom
      spec: "新增/编辑表单中移除这些字段的 el-form-item"
    bindTo: ["del_flag", "create_by", "create_time", "update_by", "update_time"]
    service: null
    notes: "这些字段在实体类中保留，但前端表单中不显示"

  # 7. 联系人至少1个验证
  contact_validation:
    intent: "联系人信息至少1个：新增时必须添加，编辑时不允许全部删除"
    component:
      type: custom
      spec: |
        表单验证规则：
        1. 新增时：contactList 数组长度 >= 1
        2. 编辑时：删除联系人前检查，如果只剩1个则提示不允许删除
        3. 提交时：验证 contactList.length >= 1
    bindTo: pm_customer_contact
    service: null
    notes: |
      表单验证规则：
      contactList: [
        { required: true, message: '至少需要添加一个联系人', trigger: 'change' },
        { type: 'array', min: 1, message: '至少需要添加一个联系人', trigger: 'change' }
      ]

  # 8. 联系人标签字典数据
  contact_tag_dict:
    intent: "联系人标签使用字典类型 contact_tag，加载字典数据显示下拉选项"
    component:
      type: el-select
      props:
        style: "width: 100%"
        placeholder: "请选择标签"
        size: "small"
    bindTo: contact_tag
    service: null
    notes: |
      前端实现：
      1. useDict 加载字典：const { contact_tag } = proxy.useDict('contact_tag')
      2. 下拉框绑定字典数据：
         <el-option
           v-for="dict in contact_tag"
           :key="dict.value"
           :label="dict.label"
           :value="dict.value"
         />

  # 9. 联系人行内编辑和删除
  contact_inline_edit:
    intent: "联系人表格行内编辑，每行添加删除按钮，点击直接删除不弹对话框"
    component:
      type: custom
      spec: |
        表格所有字段均为可编辑状态（input/select）
        每行后添加删除按钮，点击直接删除该行
        移除批量删除按钮和复选框列
    bindTo: pm_customer_contact
    service: null
    notes: |
      实现方式：
      1. 移除批量删除按钮和 selection 列
      2. 所有字段使用 el-input 或 el-select，size="small"
      3. 添加操作列，包含删除按钮：
         <el-button link type="danger" size="small" icon="Delete" @click="handleDeleteContactRow(scope.$index)">删除</el-button>
      4. 删除方法：customerContactList.value.splice(index, 1)
      5. 删除前验证至少保留1个联系人

  # 10. 表单布局优化
  form_layout_optimization:
    intent: "查询表单和编辑表单布局优化：客户信息两列布局，联系人表格均匀分布，按钮大小统一"
    component:
      type: custom
      spec: |
        查询表单：
        - label-width: 100px
        - 输入框宽度：240px（统一）
        - 添加销售负责人查询条件

        编辑表单：
        - Dialog 宽度：900px
        - label-width: 120px
        - 客户信息：两列布局（el-row + el-col :span="12"）
        - 备注：单独一行（:span="24"）
        - 所有下拉框：style="width: 100%"

        联系人表格：
        - 序号列：80px（固定）
        - 联系人姓名、电话、标签、备注：自动宽度（均匀分配）
        - 操作列：100px（固定）
        - 所有组件：size="small"（统一）
    bindTo: form
    service: null
    notes: |
      查询表单：label-width='100px'，所有输入框 style='width: 240px'
      编辑表单：label-width='120px'，Dialog width='900px'
      联系人表格列宽：序号(80px) + 姓名/电话/标签/备注(自动) + 操作(100px)

  # 11. 删除确认提示优化
  delete_confirmation:
    intent: "删除客户提示信息显示客户简称，不显示ID"
    component:
      type: custom
      spec: "删除确认对话框中显示客户简称而非ID"
    bindTo: delete
    service: null
    notes: "ElMessageBox.confirm(`是否确认删除客户\"${row.customerSimpleName}\"？`, '警告', ...)"

  # 12. 列表显示优化
  list_display_optimization:
    intent: "列表不显示客户主键ID，添加序号列，显示完整业务字段"
    component:
      type: custom
      spec: |
        列表显示列：
        - 复选框（selection）
        - 序号（type="index"，width="60"）
        - 客户简称
        - 客户全称
        - 所属行业（字典标签）
        - 所属区域（字典标签）
        - 销售负责人（显示昵称）
        - 办公地址
        - 备注
        - 操作（修改/删除）
    bindTo: list
    service: null
    notes: |
      移除客户主键ID列，添加序号列：
      <el-table-column label="序号" type="index" width="60" align="center" />

  # 14. 联系人备注列
  contact_remark_column:
    intent: "联系人信息表格添加备注列，支持行内编辑"
    component:
      type: el-input
      props:
        placeholder: "请输入备注"
        size: "small"
    bindTo: pm_customer_contact.remark
    service: null
    notes: |
      联系人表格列顺序：
      1. 序号（80px）
      2. 联系人姓名（自动宽度）
      3. 联系人电话（自动宽度）
      4. 联系人标签（自动宽度）
      5. 备注（自动宽度，新增）
      6. 操作（100px）

  # 15. 查询条件完善
  query_conditions_enhancement:
    intent: "查询条件添加客户全称和销售负责人，统一输入框宽度"
    component:
      type: custom
      spec: |
        查询条件：
        - 客户简称（autocomplete，240px）
        - 客户全称（input，240px，新增）
        - 所属行业（select，240px）
        - 所属区域（select，240px）
        - 销售负责人（select，240px，filterable，新增）
    bindTo: queryParams
    service: null
    notes: |
      1. 客户全称添加到查询条件，isQuery 改为 true
      2. 销售负责人查询条件绑定 salesManagerList
      3. 所有输入框统一宽度 240px
