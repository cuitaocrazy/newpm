# ============================
# Tab 1: 基本信息
# ============================
basicInfo:
  tableName: pm_project
  tableComment: 项目管理表
  className: Project
  functionAuthor: ruoyi
  remark: |
    字段更新记录：
    1. province_id → region_id (2026-02-11完成)
       - 数据库字段：province_id → region_id
       - Java实体类：provinceId → regionId
       - 前端字段：provinceCode → regionCode (用于显示), provinceId → regionId (用于保存)
       - Mapper XML：已更新

    2. project_status → project_stage (2026-02-11完成)
       - 数据库字段：project_status → project_stage
       - Java实体类：projectStatus → projectStage
       - 前端字段：projectStatus → projectStage
       - 字典类型：sys_xmjd（项目阶段）
       - 界面标签：项目状态 → 项目阶段

    3. 立项年度使用字典 sys_ndgl (2026-02-11完成)
       - 前端：去掉自定义年份选项数组，改用字典 sys_ndgl
       - 标签：立项年份 → 立项年度
       - 文件：edit.vue, apply.vue

    4. 项目编号格式提示已移除 (2026-02-11完成)
       - 编辑页面不再显示格式说明文字
       - 仅保留自动生成的编号字段

    5. 编辑页面移除收入确认模块 (2026-02-11完成)
       - 去掉第7个面板（收入确认）
       - 移除字段：revenueConfirmStatus, revenueConfirmYear, confirmAmount, taxRate, afterTaxAmount
       - 移除函数：calculateAfterTaxAmount()
       - 页面布局：从7个模块改为6个模块
       - 注意：这些字段仍在数据库和实体类中保留，用于其他模块（如收入确认列表）

    6. 列表页面部门显示优化 (2026-02-11完成)
       - 显示逻辑：展示从第三级开始的完整部门路径
       - 格式：使用'-'连接，如"事业部-开发部-研发组"
       - 实现：getDeptName() 函数，通过 ancestors 字段解析层级关系
       - Mapper：selectDeptTree() 返回所有部门（不过滤），前端过滤三级及以下用于下拉选择

    7. 详情页面名称回显 (2026-02-11完成)
       - 项目经理、市场经理、销售负责人：显示昵称而非ID
       - 客户名称、客户联系人：显示名称而非ID
       - 实现：loadRelatedNames() 函数，通过ID查询对应名称
       - 文件：detail.vue

    8. 审核功能改造 - 编辑页面动态按钮 (2026-02-12完成)
       - 功能：根据审核状态动态显示提交按钮
       - 已拒绝状态(approval_status='2')：
         * 按钮文字："重新提交审核"
         * 按钮图标：RefreshRight
         * 页面顶部显示黄色警告框，展示拒绝原因
         * 提交后自动变为"待审核"状态，生成重新提交审核记录
       - 其他状态(0待审核/1已通过)：
         * 按钮文字："保存"
         * 按钮图标：Select
         * 仅保存修改，不触发审核流程
       - 实现文件：edit.vue
       - 实现方式：
         * computed属性：submitButtonText, submitButtonIcon
         * 提示组件：el-alert (v-if="form.approvalStatus === '2'")
       - 后端支持：
         * ProjectController.edit() 检测原状态
         * 已拒绝项目修改时自动变为待审核
         * 自动生成pm_project_approval记录

    9. 操作列按钮调整 (2026-02-12完成)
       - 移除按钮：
         * "审核"按钮（待审核状态显示）
         * "审核历史"按钮
       - 保留按钮：
         * 详情、编辑、收入确认/收入查看、删除
       - 操作列宽度：400px → 300px
       - 说明：审核功能代码保留在文件中，可在专门的审核列表页使用
       - 实现文件：index.vue

    10. 列表显示优化 - 二级区域列 (2026-02-12完成)
        - 项目管理列表(/project/project)：
          * 在"项目分类"列后面添加"二级区域"列
          * 显示字段：regionName（来自 pm_secondary_region.region_name）
          * 列宽：min-width="120px"，支持 show-overflow-tooltip
          * 数据来源：Mapper XML 已关联查询 pm_secondary_region 表
        - 实现文件：ruoyi-ui/src/views/project/project/index.vue
        - 后端支持：ProjectMapper.xml 已有 LEFT JOIN pm_secondary_region

    11. 公司收入确认列表优化 (2026-02-12完成)
        - 删除"项目编码"列（原位置：项目名称之后）
        - 删除"一级区域"列（原位置：项目分类之后）
        - 保留"二级区域"列
        - 优化后列顺序：项目名称 → 项目部门 → ... → 项目分类 → 二级区域 → 项目阶段
        - 实现文件：ruoyi-ui/src/views/revenue/company/index.vue

    12. 选择器组件重构 (2026-02-12完成)
        - 创建通用选择器组件：
          * DictSelect - 字典选择器，自动加载字典数据
          * UserSelect - 用户选择器，支持按岗位筛选（pm/scjl/xsfzr）
          * SecondaryRegionSelect - 二级区域选择器，自动联动一级区域
        - 组件位置：ruoyi-ui/src/components/
        - 全局注册：ruoyi-ui/src/main.ts
        - 迁移页面（5个）：
          * /project/review/index.vue - 项目审核列表
          * /revenue/company/index.vue - 公司收入确认
          * /project/project/index.vue - 项目列表
          * /project/project/apply.vue - 立项申请
          * /project/project/edit.vue - 项目编辑
        - 代码优化：
          * 减少重复代码约520行
          * 统一交互体验
          * 简化新页面开发
        - 特殊处理：
          * apply.vue 和 edit.vue 的二级区域保留原实现（使用 regionCode 字段）
          * edit.vue 的参与人员保留原实现（自定义标签展示）

    13. 一级区域联动修复 (2026-02-12完成)
        - 问题：一级区域选择后，二级区域没有动态加载数据
        - 原因：迁移到 DictSelect 后忘记添加 @change 事件
        - 修复内容：
          * apply.vue：一级区域添加 @change="handleRegionChange"
          * edit.vue：一级区域添加 @change="handleRegionChange"
        - 实现文件：
          * ruoyi-ui/src/views/project/project/apply.vue
          * ruoyi-ui/src/views/project/project/edit.vue

    14. 路由跳转修复 (2026-02-12完成)
        - 问题：编辑页面点击取消按钮后出现404
        - 原因：路由路径不一致
          * 提交成功：router.push('/project/list') ✓
          * 取消按钮：router.push('/project/project') ✗
        - 修复：统一使用 /project/list
        - 实现文件：
          * ruoyi-ui/src/views/project/project/edit.vue - cancel()
          * ruoyi-ui/src/views/project/project/apply.vue - cancel()

    15. edit.vue 代码清理 (2026-02-12完成)
        - 删除不再使用的代码（已被 UserSelect 组件替代）：
          * refs：projectManagers, marketManagers, salesManagers
          * 函数：loadProjectManagers(), loadMarketManagers(), loadSalesManagers()
          * onMounted 调用：删除上述三个函数的调用
        - 销售负责人自动填充优化：
          * 从 watch 改为 @change 事件处理
          * 新增：handleSalesManagerChange(userId, user) 函数
          * UserSelect 添加 @change="handleSalesManagerChange"
        - 代码减少：约30行
        - 实现文件：ruoyi-ui/src/views/project/project/edit.vue

    16. 项目附件管理功能 (2026-02-13完成)
        - 功能描述：为项目管理添加完整的附件管理功能
        - 前端实现：
          * 新增页面：ruoyi-ui/src/views/project/project/attachment.vue
          * 页面结构：
            - 上半部分：展示完整的6个项目详情模块
            - 下半部分：附件上传、附件列表、操作日志
          * 项目列表操作列添加"附件管理"按钮
          * 路由配置：/project/list/attachment/:projectId (隐藏菜单)
        - 后端实现：
          * 业务类型：businessType = 'project'
          * 控制器：AttachmentController (已支持)
          * 服务层：AttachmentServiceImpl (已支持)
          * 存储路径：项目/{projectId}_{projectName}/{yyyyMMdd}/{fileName}
        - 数据库：
          * 附件表：pm_attachment
          * 操作日志表：pm_attachment_log
        - 菜单配置：
          * SQL文件：pm-sql/init/02_menu_data.sql
          * 菜单名称：项目附件管理
          * 可见性：hidden (visible='1')
          * 父菜单：项目管理一级菜单
          * 权限标识：project:project:query
        - 实现文件：
          * ruoyi-ui/src/views/project/project/attachment.vue
          * ruoyi-ui/src/views/project/project/index.vue
          * pm-sql/init/02_menu_data.sql

    17. 项目详情区域显示优化 (2026-02-13完成)
        - 问题：项目详情和附件管理页面只显示"区域"，缺少二级区域
        - 修复内容：
          * 将"区域"字段拆分为"一级区域"和"二级区域"
          * 一级区域：显示字典标签 (sys_yjqy)
          * 二级区域：显示区域名称 (regionName)
        - 影响页面：
          * ruoyi-ui/src/views/project/project/detail.vue
          * ruoyi-ui/src/views/project/project/attachment.vue
        - 同时添加审核意见字段：
          * 在项目基本信息末尾添加"审核意见"字段
          * 显示：approvalReason，占据3列宽度

    18. 项目附件存储路径优化 (2026-02-13完成)
        - 调整前：项目/{projectId}/{yyyyMMdd}/{fileName}
        - 调整后：项目/{projectId}_{projectName}/{yyyyMMdd}/{fileName}
        - 优点：路径包含项目名称，提高可读性和可维护性
        - 实现方式：
          * 注入 ProjectMapper 到 AttachmentServiceImpl
          * getBusinessFolder() 方法查询项目信息
          * 路径格式与合同保持一致

    19. 文件上传路径跨平台配置 (2026-02-13完成)
        - 配置文件：ruoyi-admin/src/main/resources/application.yml
        - 配置项：ruoyi.profile
        - 调整前：绝对路径（特定于操作系统）
          * Windows: D:/ruoyi/uploadPath
          * Linux: /home/ruoyi/uploadPath
          * Mac: /Users/kongli/ws-claude/PM/newpm/uploadPath
        - 调整后：使用用户主目录变量（跨平台）
          * 配置值：${user.home}/ruoyi/uploadPath
          * Windows 实际路径：C:\Users\用户名\ruoyi\uploadPath
          * Linux 实际路径：/home/用户名/ruoyi/uploadPath
          * Mac 实际路径：/Users/用户名/ruoyi/uploadPath
        - 优势：
          * ✅ 完全跨平台，无需修改配置
          * ✅ 一次配置，到处运行
          * ✅ 每个用户独立的上传空间
          * ✅ 文件独立于项目目录，不会误提交
          * ✅ 开发和生产环境都适用
          * ✅ 用户目录下无需 sudo 权限
        - 使用说明：
          * 团队成员克隆代码后无需修改配置
          * 只需创建目录：mkdir -p ~/ruoyi/uploadPath
          * Spring Boot 会自动解析 ${user.home} 变量
        - 实现文件：
          * ruoyi-admin/src/main/resources/application.yml
        - 相关组件：
          * FileUploadUtils - 文件上传工具类
          * AttachmentServiceImpl - 附件服务实现（项目、合同、款项）
        - 注意事项：
          * 首次使用需手动创建 ~/ruoyi/uploadPath 目录
          * 如需修改路径，可通过环境变量覆盖：
            export UPLOAD_PATH=/custom/path（需同时修改配置为 ${UPLOAD_PATH:/default/path}）
        - 实现文件：
          * ruoyi-project/src/main/java/com/ruoyi/project/service/impl/AttachmentServiceImpl.java
        - 示例路径：
          * uploadPath/项目/2_测试项目名称/20260213/需求文档.pdf

    19. 附件日志查询 collation 修复 (2026-02-13完成)
        - 问题：查询附件操作日志时报错
          * 错误：Illegal mix of collations (utf8mb4_0900_ai_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT)
          * 原因：pm_attachment_log 表使用 MySQL 8.0 默认 collation，sys_dict_data 表使用框架默认 collation
        - 修复方案：
          * 在 JOIN 条件中显式指定 collation
          * 语法：l.document_type COLLATE utf8mb4_unicode_ci = d.dict_value
        - 实现文件：
          * ruoyi-project/src/main/resources/mapper/project/AttachmentLogMapper.xml
        - 修复位置：
          * selectAttachmentLogVo SQL片段中的 LEFT JOIN 条件

# ============================
# Tab 2: 字段信息
# ============================
columns:
  project_id:
    columnComment: 项目ID
    columnType: bigint
    javaType: Long
    javaField: projectId
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  project_code:
    columnComment: 项目编号
    columnType: varchar(50)
    javaType: String
    javaField: projectCode
    isInsert: true  # 新增时生成
    isEdit: false   # 编辑时只读，不可修改
    isList: true    # 列表显示
    isQuery: true   # 支持查询
    queryType: LIKE
    isRequired: true
    htmlType: input
    dictType: ""

  project_name:
    columnComment: 项目名称
    columnType: varchar(200)
    javaType: String
    javaField: projectName
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: LIKE
    isRequired: true
    htmlType: input
    dictType: ""

  project_full_name:
    columnComment: 项目全称
    columnType: varchar(500)
    javaType: String
    javaField: projectFullName
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: LIKE
    isRequired: false
    htmlType: textarea
    dictType: ""

  industry:
    columnComment: 行业
    columnType: varchar(50)
    javaType: String
    javaField: industry
    isInsert: true
    isEdit: true
    isList: false
    isQuery: true
    queryType: EQ
    isRequired: true
    htmlType: select
    dictType: "industry"

  region:
    columnComment: 一级区域
    columnType: varchar(50)
    javaType: String
    javaField: region
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: EQ
    isRequired: true
    htmlType: select
    dictType: "sys_yjqy"

  region_id:
    columnComment: 二级区域ID（关联pm_secondary_region表）
    columnType: bigint
    javaType: Long
    javaField: regionId
    isInsert: true
    isEdit: true
    isList: false  # 列表不显示ID，显示名称
    isQuery: true  # 支持按二级区域查询
    queryType: EQ
    isRequired: true
    htmlType: select
    dictType: ""

  short_name:
    columnComment: 项目简称
    columnType: varchar(50)
    javaType: String
    javaField: shortName
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: LIKE
    isRequired: true
    htmlType: input
    dictType: ""

  established_year:
    columnComment: 立项年度
    columnType: int
    javaType: Integer
    javaField: establishedYear
    isInsert: true
    isEdit: true
    isList: false
    isQuery: true
    queryType: EQ
    isRequired: true
    htmlType: select
    dictType: "sys_ndgl"

  project_category:
    columnComment: 项目分类
    columnType: varchar(50)
    javaType: String
    javaField: projectCategory
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: EQ
    isRequired: true
    htmlType: select
    dictType: "sys_xmfl"

  project_dept:
    columnComment: 项目部门
    columnType: varchar(100)
    javaType: String
    javaField: projectDept
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: EQ
    isRequired: true
    htmlType: treeselect
    dictType: ""

  project_stage:
    columnComment: 项目阶段
    columnType: varchar(50)
    javaType: String
    javaField: projectStage
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: EQ
    isRequired: true
    htmlType: select
    dictType: "sys_xmjd"

  acceptance_status:
    columnComment: 验收状态
    columnType: varchar(50)
    javaType: String
    javaField: acceptanceStatus
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: EQ
    isRequired: false
    htmlType: select
    dictType: "sys_yszt"

  estimated_workload:
    columnComment: 预估工作量(人天)
    columnType: decimal(10,2)
    javaType: BigDecimal
    javaField: estimatedWorkload
    isInsert: true
    isEdit: true
    isList: true
    isQuery: false
    queryType: EQ
    isRequired: true
    htmlType: input
    dictType: ""

  actual_workload:
    columnComment: 实际工作量(人天)
    columnType: decimal(10,2)
    javaType: BigDecimal
    javaField: actualWorkload
    isInsert: true
    isEdit: true
    isList: true
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  project_address:
    columnComment: 项目地址
    columnType: varchar(500)
    javaType: String
    javaField: projectAddress
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: LIKE
    isRequired: false
    htmlType: textarea
    dictType: ""

  project_plan:
    columnComment: 项目计划
    columnType: text
    javaType: String
    javaField: projectPlan
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: LIKE
    isRequired: false
    htmlType: textarea
    dictType: ""

  project_description:
    columnComment: 项目描述
    columnType: text
    javaType: String
    javaField: projectDescription
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: LIKE
    isRequired: false
    htmlType: textarea
    dictType: ""

  project_manager_id:
    columnComment: 项目经理ID
    columnType: bigint
    javaType: Long
    javaField: projectManagerId
    isInsert: true
    isEdit: true
    isList: false  # 列表显示昵称，不显示ID
    isQuery: true
    queryType: EQ
    isRequired: true
    htmlType: select
    dictType: ""

  market_manager_id:
    columnComment: 市场经理ID
    columnType: bigint
    javaType: Long
    javaField: marketManagerId
    isInsert: true
    isEdit: true
    isList: false  # 列表显示昵称，不显示ID
    isQuery: true
    queryType: EQ
    isRequired: true
    htmlType: select
    dictType: ""

  participants:
    columnComment: 参与人员ID列表(逗号分隔)
    columnType: varchar(500)
    javaType: String
    javaField: participants
    isInsert: true
    isEdit: true
    isList: true
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: select
    dictType: ""

  sales_manager_id:
    columnComment: 销售负责人ID
    columnType: bigint
    javaType: Long
    javaField: salesManagerId
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: select
    dictType: ""

  sales_contact:
    columnComment: 销售联系方式
    columnType: varchar(50)
    javaType: String
    javaField: salesContact
    isInsert: true
    isEdit: false  # 自动填充，只读
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  team_leader_id:
    columnComment: 团队负责人ID
    columnType: bigint
    javaType: Long
    javaField: teamLeaderId
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: select
    dictType: ""

  customer_id:
    columnComment: 客户ID
    columnType: bigint
    javaType: Long
    javaField: customerId
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: true
    htmlType: select
    dictType: ""

  customer_contact_id:
    columnComment: 客户联系人ID
    columnType: bigint
    javaType: Long
    javaField: customerContactId
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: select
    dictType: ""

  merchant_contact:
    columnComment: 商户联系人
    columnType: varchar(100)
    javaType: String
    javaField: merchantContact
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: LIKE
    isRequired: false
    htmlType: input
    dictType: ""

  merchant_phone:
    columnComment: 商户联系方式
    columnType: varchar(50)
    javaType: String
    javaField: merchantPhone
    isInsert: true
    isEdit: false  # 自动填充，只读
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  start_date:
    columnComment: 启动日期
    columnType: date
    javaType: Date
    javaField: startDate
    isInsert: true
    isEdit: true
    isList: true
    isQuery: false
    queryType: BETWEEN
    isRequired: false
    htmlType: datetime
    dictType: ""

  end_date:
    columnComment: 结束日期
    columnType: date
    javaType: Date
    javaField: endDate
    isInsert: true
    isEdit: true
    isList: true
    isQuery: false
    queryType: BETWEEN
    isRequired: false
    htmlType: datetime
    dictType: ""

  production_date:
    columnComment: 投产日期
    columnType: date
    javaType: Date
    javaField: productionDate
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: BETWEEN
    isRequired: false
    htmlType: datetime
    dictType: ""

  acceptance_date:
    columnComment: 验收日期
    columnType: date
    javaType: Date
    javaField: acceptanceDate
    isInsert: true
    isEdit: true
    isList: true
    isQuery: false
    queryType: BETWEEN
    isRequired: false
    htmlType: datetime
    dictType: ""

  project_budget:
    columnComment: 项目预算(元)
    columnType: decimal(15,2)
    javaType: BigDecimal
    javaField: projectBudget
    isInsert: true
    isEdit: true
    isList: true
    isQuery: false
    queryType: EQ
    isRequired: true
    htmlType: input
    dictType: ""

  project_cost:
    columnComment: 项目费用(元)
    columnType: decimal(15,2)
    javaType: BigDecimal
    javaField: projectCost
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  expense_budget:
    columnComment: 费用预算(元)
    columnType: decimal(15,2)
    javaType: BigDecimal
    javaField: expenseBudget
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  cost_budget:
    columnComment: 成本预算(元)
    columnType: decimal(15,2)
    javaType: BigDecimal
    javaField: costBudget
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  labor_cost:
    columnComment: 人力费用(元)
    columnType: decimal(15,2)
    javaType: BigDecimal
    javaField: laborCost
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  purchase_cost:
    columnComment: 采购成本(元)
    columnType: decimal(15,2)
    javaType: BigDecimal
    javaField: purchaseCost
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  approval_status:
    columnComment: 审批状态(0待审核/1已通过/2已拒绝)
    columnType: varchar(20)
    javaType: String
    javaField: approvalStatus
    isInsert: true   # 新增时默认为待审核
    isEdit: false    # 编辑时只读，由审核流程控制
    isList: true
    isQuery: true
    queryType: EQ
    isRequired: false
    htmlType: select
    dictType: "sys_spzt"

  approval_reason:
    columnComment: 审批意见
    columnType: varchar(500)
    javaType: String
    javaField: approvalReason
    isInsert: false  # 新增时不填写
    isEdit: false    # 编辑时只读，由审核流程填写
    isList: false
    isQuery: false
    queryType: LIKE
    isRequired: false
    htmlType: textarea
    dictType: ""

  industry_code:
    columnComment: 行业代码
    columnType: varchar(50)
    javaType: String
    javaField: industryCode
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  region_code:
    columnComment: 二级区域代码（从pm_secondary_region表的region_code字段获取）
    columnType: varchar(50)
    javaType: String
    javaField: regionCode
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  approval_time:
    columnComment: 审批时间
    columnType: datetime
    javaType: Date
    javaField: approvalTime
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: datetime
    dictType: ""

  approver_id:
    columnComment: 审批人
    columnType: varchar(64)
    javaType: String
    javaField: approverId
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  remark:
    columnComment: 备注
    columnType: text
    javaType: String
    javaField: remark
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: textarea
    dictType: ""

  tax_rate:
    columnComment: 税率(%)
    columnType: decimal(5,2)
    javaType: BigDecimal
    javaField: taxRate
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: select
    dictType: ""

  confirm_user_id:
    columnComment: 确认人ID
    columnType: bigint
    javaType: Long
    javaField: confirmUserId
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: select
    dictType: ""

  confirm_time:
    columnComment: 确认时间
    columnType: datetime
    javaType: Date
    javaField: confirmTime
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: datetime
    dictType: ""

  reserved_field1:
    columnComment: 备用域1
    columnType: varchar(64)
    javaType: String
    javaField: reservedField1
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  reserved_field2:
    columnComment: 备用域2
    columnType: varchar(64)
    javaType: String
    javaField: reservedField2
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  reserved_field3:
    columnComment: 备用域3
    columnType: varchar(64)
    javaType: String
    javaField: reservedField3
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  reserved_field4:
    columnComment: 备用域4
    columnType: varchar(64)
    javaType: String
    javaField: reservedField4
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  reserved_field5:
    columnComment: 备用域5
    columnType: varchar(64)
    javaType: String
    javaField: reservedField5
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  del_flag:
    columnComment: 删除标志(0正常 1删除)
    columnType: char(1)
    javaType: String
    javaField: delFlag
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  create_by:
    columnComment: 创建者
    columnType: varchar(64)
    javaType: String
    javaField: createBy
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  create_time:
    columnComment: 创建时间
    columnType: datetime
    javaType: Date
    javaField: createTime
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: datetime
    dictType: ""

  update_by:
    columnComment: 更新者
    columnType: varchar(64)
    javaType: String
    javaField: updateBy
    isInsert: false
    isEdit: false
    isList: true
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  update_time:
    columnComment: 更新时间
    columnType: datetime
    javaType: Date
    javaField: updateTime
    isInsert: false
    isEdit: false
    isList: true
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: datetime
    dictType: ""

  revenue_confirm_status:
    columnComment: 收入确认状态(字典:sys_srqrzt 未确认、待确认、已确认、无法确认)
    columnType: varchar(20)
    javaType: String
    javaField: revenueConfirmStatus
    isInsert: true
    isEdit: true
    isList: true
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: select
    dictType: "sys_srqrzt"

  revenue_confirm_year:
    columnComment: 收入确认年度
    columnType: varchar(20)
    javaType: String
    javaField: revenueConfirmYear
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: EQ
    isRequired: false
    htmlType: select
    dictType: "sys_ndgl"

  confirm_amount:
    columnComment: 确认金额（含税）
    columnType: decimal(15,2)
    javaType: BigDecimal
    javaField: confirmAmount
    isInsert: true
    isEdit: true
    isList: true
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  after_tax_amount:
    columnComment: 税后金额
    columnType: decimal(15,2)
    javaType: BigDecimal
    javaField: afterTaxAmount
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  company_revenue_confirmed_by:
    columnComment: 公司收入确认人ID
    columnType: varchar(64)
    javaType: String
    javaField: companyRevenueConfirmedBy
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""

  company_revenue_confirmed_time:
    columnComment: 公司收入确认时间
    columnType: datetime
    javaType: Date
    javaField: companyRevenueConfirmedTime
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: datetime
    dictType: ""

# ============================
# Tab 3: 生成信息
# ============================
genInfo:
  tplCategory: crud
  tplWebType: element-plus
  packageName: com.ruoyi.project
  moduleName: project
  businessName: project
  functionName: 项目管理
  parentMenuId: 3

# ============================
# 定制需求（超出标准模板的组件/交互/接口需求）
# ============================
customizations:
  # ==================
  # 后端实现说明
  # ==================
  backend_implementation:
    intent: "后端数据处理和保存逻辑"
    component:
      type: "custom"
      spec: |
        关键字段的后端处理：

        1. 二级区域（regionId 和 regionCode 双字段）
           实体类字段：
           - private Long regionId;      // 保存到数据库，用于关联查询
           - private String regionCode;  // 用于项目编号生成和显示

           Mapper SQL（ProjectMapper.xml）：
           - INSERT: 同时保存 region_id 和 region_code
           - UPDATE: 允许更新两个字段
           - SELECT: 同时查询两个字段

           业务逻辑：
           - 前端提交时包含 regionCode 和 regionId
           - 后端直接保存，无需额外转换
           - 查询二级区域列表接口返回：regionId, regionName, regionCode

        2. 项目阶段（projectStage）
           实体类字段：
           - private String projectStage;  // 字典值 sys_xmjd

           验证规则：
           - 立项申请：必填
           - 项目编辑：必填

        3. 参与人员（participants）
           实体类字段：
           - private String participants;  // 逗号分隔的userId字符串，如 "1,2,3"

           数据转换：
           - 前端提交：数组 → join(',') → 字符串
           - 后端保存：直接保存字符串
           - 查询回显：字符串 → split(',') → 数组

        4. 项目编号（projectCode）
           生成规则：
           - 格式：{industry}-{region}-{regionCode}-{shortName}-{establishedYear}
           - 示例：IT-华东-JS-ERP-2024
           - 实现：前端自动生成，后端保存
           - 唯一性：数据库 UNIQUE 约束

    bindTo: "backend_logic"
    service: null
    notes: |
      重要约定：
      1. regionId 和 regionCode 必须同时保存，保持数据一致性
      2. projectStage 使用字典值，不要使用字典标签
      3. participants 存储格式固定为逗号分隔字符串
      4. projectCode 在数据库中有唯一性约束，保存前需验证

  # ==================
  # 前端字段绑定说明
  # ==================
  frontend_field_binding:
    intent: "前端表单字段绑定规范，确保数据正确保存和回显"
    component:
      type: "custom"
      spec: |
        关键字段的前后端映射关系：

        1. 二级区域（双字段机制）
           - 前端绑定：v-model="form.regionCode" (用于下拉选择和显示)
           - 后端保存：form.regionId (bigint, 外键关联 pm_secondary_region.region_id)
           - 后端查询：form.regionCode (varchar, 用于显示和编码生成)
           - 数据流向：
             用户选择 → regionCode → 查找对应的 regionId → 同时保存 regionCode 和 regionId

        2. 项目阶段
           - 前端绑定：v-model="form.projectStage"
           - 后端字段：project_stage
           - 字典类型：sys_xmjd

        3. 参与人员（数组与字符串转换）
           - 前端绑定：v-model="participantIds" (Array<number>)
           - 后端保存：form.participants (String, 逗号分隔，如 "1,2,3")
           - 提交前转换：participantIds.join(',')
           - 回显时转换：participants.split(',').map(Number)

        4. 项目编号（自动生成）
           - 前端生成：projectCode = `${industry}-${region}-${regionCode}-${shortName}-${establishedYear}`
           - 后端字段：project_code
           - 新增时：自动生成，禁用输入
           - 编辑时：只读显示，不可修改
    bindTo: "form_binding"
    service: null
    notes: |
      重要：理解双字段机制（regionCode + regionId）的原因：
      - regionCode：用于项目编号生成、前端显示
      - regionId：用于数据库关联、后端查询优化
      这是典型的"显示用编码 + 保存用ID"的设计模式

  project_stage_field:
    intent: "项目阶段字段说明（原项目状态字段已重命名）"
    component:
      type: "el-select"
      props:
        clearable: true
        placeholder: "请选择项目阶段"
    bindTo: "projectStage"
    service: null
    notes: |
      字段变更历史（2026-02-11）：
      - 数据库字段：project_status → project_stage
      - Java字段：projectStatus → projectStage
      - 前端字段：projectStatus → projectStage
      - 界面标签：项目状态 → 项目阶段
      - 字典类型：sys_xmjd（项目阶段）

      字典选项（sys_xmjd）：
      - 需求分析
      - 设计阶段
      - 开发阶段
      - 部署阶段
      - 测试阶段
      - 运维阶段

      使用场景：
      - 立项申请：必填
      - 项目编辑：必填
      - 项目列表：显示并支持筛选

  # ==================
  # 表单字段定制
  # ==================
  project_code_auto_generate:
    intent: "项目编号自动生成，格式：{行业代码}-{一级区域代码}-{二级区域代码}-{简称}-{立项年份}"
    component:
      type: "el-input"
      props:
        disabled: true  # 新增时禁用输入
        readonly: true  # 编辑时只读显示
    bindTo: "project_code"
    service:
      endpoint: "POST /project/project/generateCode"
      source: "ProjectService.generateProjectCode"
      params: ["industryCode", "regionCode", "secondaryRegionCode", "shortName", "establishedYear"]
      returns: "生成的项目编号字符串"
      newApi: false
    notes: |
      项目编号由5个部分组成，用'-'分隔：
      1. 行业代码（industryCode - industry字典值）
      2. 一级区域代码（regionCode - region字典值）
      3. 二级区域代码（secondaryRegionCode - 从pm_secondary_region表的region_code字段获取）
      4. 项目简称（shortName - 用户输入的short_name）
      5. 立项年份（establishedYear - established_year）

      前端实现：监听这5个字段变化（industry, region, regionCode, shortName, establishedYear），
      当全部填写时，直接在前端拼接生成项目编号，无需调用后端接口。
      生成逻辑：projectCode = `${industry}-${region}-${regionCode}-${shortName}-${establishedYear}`
      新增页面：禁用输入，自动生成后回填
      编辑页面：只读显示，不可修改

  project_name_autocomplete:
    intent: "项目名称查询条件支持自动完成功能，组件宽度与其他查询组件统一"
    component:
      type: "el-autocomplete"
      props:
        fetch-suggestions: "queryProjectNames"
        clearable: true
        placeholder: "请输入项目名称"
        style: "width: 240px"
    bindTo: "project_name"
    service: null
    notes: "2026-02-11优化：宽度从 100% 改为 240px，与所有查询组件统一"

  region_id_dynamic_loading:
    intent: "二级区域下拉框根据一级区域动态加载数据"
    component:
      type: "el-select"
      props:
        filterable: true
        clearable: true
        placeholder: "请选择二级区域"
        disabled: "!form.region"  # 未选择一级区域时禁用
    bindTo: "regionCode"  # 前端使用 regionCode 作为表单绑定字段
    service:
      endpoint: "GET /project/project/secondaryRegions?regionDictValue={region}"
      source: "ProjectMapper.selectSecondaryRegionsByRegion"
      params: ["regionDictValue"]
      returns: "二级区域列表，包含 regionId, regionName, regionCode"
      newApi: false
    implementation: |
      前端实现示例（apply.vue / edit.vue）：

      模板部分：
      <el-select v-model="form.regionCode" placeholder="请选择二级区域"
                 :disabled="!form.region" @change="handleSecondaryRegionChange">
        <el-option v-for="item in secondaryRegionOptions" :key="item.regionCode"
                   :label="item.regionName" :value="item.regionCode" />
      </el-select>

      脚本部分：
      // 数据
      const form = ref({
        region: '',
        regionCode: '',  // 用于显示和编码生成
        regionId: null   // 用于保存到数据库
      })
      const secondaryRegionOptions = ref([])

      // 一级区域变化事件
      function handleRegionChange(value) {
        form.value.regionCode = null
        form.value.regionId = null
        getSecondaryRegions(value)
      }

      // 二级区域变化事件
      function handleSecondaryRegionChange(regionCode) {
        if (!regionCode) {
          form.value.regionId = null
          return
        }
        const selectedRegion = secondaryRegionOptions.value.find(item => item.regionCode === regionCode)
        if (selectedRegion) {
          form.value.regionId = selectedRegion.regionId
        }
      }

      // 加载二级区域列表
      function getSecondaryRegions(regionDictValue) {
        request({
          url: '/project/project/secondaryRegions',
          method: 'get',
          params: { regionDictValue: regionDictValue }
        }).then(response => {
          secondaryRegionOptions.value = response.data || []
        })
      }
    notes: |
      1. 监听一级区域(region)字段变化
      2. 当一级区域改变时，清空二级区域选择（regionCode 和 regionId），重新加载数据
      3. 通过 region_dict_value 字段关联查询 pm_secondary_region 表
      4. 下拉选项：显示 regionName，值为 regionCode
      5. 选择后，根据 regionCode 查找对应的 regionId 并保存到 form.regionId
      6. 提交数据时，后端同时接收 regionCode 和 regionId 两个字段

  participants_multi_select:
    intent: "参与人员使用多选自动完成组件，支持搜索所有用户并以标签展示"
    component:
      type: "custom"
      spec: |
        使用 el-select 的 multiple 模式 + filterable：
        - multiple: true
        - filterable: true
        - clearable: true
        - placeholder: "请选择参与人员"
        - collapse-tags: true
        - collapse-tags-tooltip: true

        选中的用户以 el-tag 形式展示在输入框中，支持点击删除
    bindTo: "participants"
    service:
      endpoint: "GET /system/user/list"
      source: "SysUserService.selectUserList"
      params: null
      returns: "所有用户列表，显示 nickName，值为 userId"
      newApi: false
    notes: |
      1. 后端存储格式：逗号分隔的 userId 字符串，如 "1,2,3"
      2. 前端展示格式：数组 [1, 2, 3]
      3. 提交时需要将数组转换为逗号分隔字符串
      4. 回显时需要将字符串转换为数组

  project_dept_tree_select:
    intent: "项目部门使用树形选择器，仅展示三级及以下机构；列表显示从第三级开始的完整路径"
    component:
      type: "el-tree-select"
      props:
        check-strictly: true
        clearable: true
        filterable: true
        placeholder: "请选择项目部门"
        props: "{ label: 'label', value: 'value', children: 'children' }"
    bindTo: "project_dept"
    service:
      endpoint: "GET /project/project/deptTree"
      source: "ProjectMapper.selectDeptTree"
      params: null
      returns: "所有部门数据（不过滤），包含 deptId, parentId, deptName, ancestors"
      newApi: false
    notes: |
      1. 后端返回所有部门的扁平数据：deptId, parentId, deptName, ancestors
      2. 前端处理逻辑：
         - 下拉选择：过滤出三级及以下部门（ancestors中逗号数>=3），转换为树形结构
         - 列表显示：使用全部门数据构建路径
      3. 使用 handleTree 工具函数构建树形结构

      列表显示逻辑（2026-02-11完成）：
      - 显示格式：从第三级开始的完整路径，用'-'连接
      - 示例："事业部-开发部-研发组"（不显示公司、集团等前两级）
      - 实现函数：getDeptName(deptId)
        1. 从 deptFlatList 中查找当前部门
        2. 解析 ancestors 字段（格式：0,100,101,102）
        3. 从索引2开始（第三级）遍历祖先ID
        4. 查找每个祖先的 deptName，构建路径数组
        5. 添加当前部门名称
        6. 用'-'连接返回完整路径

      数据加载：
      - deptTree: 用于下拉选择（仅三级及以下）
      - deptFlatList: 用于列表显示（包含所有部门，用于查找祖先信息）

      Mapper变更（2026-02-11）：
      - selectDeptTree() 不再过滤层级，返回所有部门
      - 前端在 loadDeptTree() 中进行过滤和转换

  sales_contact_auto_fill:
    intent: "销售联系方式根据销售负责人自动填充"
    component:
      type: "el-input"
      props:
        readonly: true
        placeholder: "自动填充"
    bindTo: "sales_contact"
    service:
      endpoint: "GET /system/user/{userId}"
      source: "SysUserService.selectUserById"
      params: ["sales_manager_id"]
      returns: "用户信息，提取 phonenumber 字段"
      newApi: false
    notes: |
      监听 sales_manager_id 字段变化，当选择销售负责人时：
      1. 调用接口获取用户详情
      2. 自动填充 phonenumber 到 sales_contact 字段
      3. 字段只读，不可手动修改

  customer_id_select:
    intent: "客户简称使用下拉选择器，支持搜索功能"
    component:
      type: "el-select"
      props:
        filterable: true
        clearable: true
        placeholder: "请选择客户"
        remote: false
    bindTo: "customer_id"
    service:
      endpoint: "GET /project/project/customers?customerSimpleName="
      source: "ProjectMapper.selectCustomers"
      params: ["customerSimpleName"]
      returns: "客户列表，包含 customerId, customerSimpleName, customerFullName"
      newApi: false
    notes: |
      1. 页面加载时获取全量客户数据
      2. 前端过滤实现搜索功能
      3. 显示 customerSimpleName，值为 customerId

  customer_contact_id_dynamic:
    intent: "客户联系人下拉框根据选择的客户动态加载"
    component:
      type: "el-select"
      props:
        filterable: true
        clearable: true
        placeholder: "请选择客户联系人"
        disabled: "!form.customer_id"  # 未选择客户时禁用
    bindTo: "customer_contact_id"
    service:
      endpoint: "GET /project/project/customerContacts?customerId={customerId}"
      source: "ProjectMapper.selectCustomerContacts"
      params: ["customerId"]
      returns: "客户联系人列表，包含 contactId, contactName, contactPhone"
      newApi: false
    notes: |
      1. 监听 customer_id 字段变化
      2. 当客户改变时，清空客户联系人选择，重新加载数据
      3. 显示 contactName，值为 contactId

  merchant_phone_auto_fill:
    intent: "商户联系方式根据客户联系人自动填充"
    component:
      type: "el-input"
      props:
        readonly: true
        placeholder: "自动填充"
    bindTo: "merchant_phone"
    service:
      endpoint: "GET /project/customer/contact/{contactId}"
      source: "CustomerContactService.selectCustomerContactByContactId"
      params: ["customer_contact_id"]
      returns: "联系人信息，提取 contactPhone 字段"
      newApi: false
    notes: |
      监听 customer_contact_id 字段变化，当选择客户联系人时：
      1. 从下拉列表的 option 数据中直接获取 contactPhone
      2. 自动填充到 merchant_phone 字段
      3. 字段只读，不可手动修改

  revenue_confirm_status_select:
    intent: "收入确认状态使用下拉框，字典类型 sys_srqrzt"
    component:
      type: "el-select"
      props:
        clearable: true
        placeholder: "请选择收入确认状态"
    bindTo: "revenue_confirm_status"
    service: null
    notes: |
      使用字典 sys_srqrzt，选项：
      - 未确认
      - 待确认
      - 已确认
      - 无法确认

  project_manager_id_select:
    intent: "项目经理下拉框，显示岗位编码为'pm'的用户"
    component:
      type: "el-select"
      props:
        filterable: true
        clearable: true
        placeholder: "请选择项目经理"
    bindTo: "project_manager_id"
    service:
      endpoint: "GET /project/project/users?postCode=pm"
      source: "ProjectMapper.selectUsersByPost"
      params: ["postCode: 'pm'"]
      returns: "用户列表，包含 userId, nickName"
      newApi: false
    notes: |
      1. 通过 sys_user_post 和 sys_post 表关联查询岗位编码为'pm'的用户
      2. 显示 nickName，值为 userId
      3. 页面加载时一次性获取数据

  market_manager_id_select:
    intent: "市场经理下拉框，显示岗位编码为'scjl'的用户"
    component:
      type: "el-select"
      props:
        filterable: true
        clearable: true
        placeholder: "请选择市场经理"
    bindTo: "market_manager_id"
    service:
      endpoint: "GET /project/project/users?postCode=scjl"
      source: "ProjectMapper.selectUsersByPost"
      params: ["postCode: 'scjl'"]
      returns: "用户列表，包含 userId, nickName"
      newApi: false
    notes: "同 project_manager_id，岗位编码不同"

  sales_manager_id_select:
    intent: "销售负责人下拉框，显示岗位编码为'xsfzr'的用户"
    component:
      type: "el-select"
      props:
        filterable: true
        clearable: true
        placeholder: "请选择销售负责人"
    bindTo: "sales_manager_id"
    service:
      endpoint: "GET /project/project/users?postCode=xsfzr"
      source: "ProjectMapper.selectUsersByPost"
      params: ["postCode: 'xsfzr'"]
      returns: "用户列表，包含 userId, nickName"
      newApi: false
    notes: "同 project_manager_id，岗位编码不同"

  # ==================
  # 列表页定制
  # ==================
  query_form_layout:
    intent: "查询表单布局优化：统一组件宽度和label宽度"
    component:
      type: "el-form"
      props:
        inline: true
        label-width: "120px"  # 确保最长的label"收入确认年度"不换行
    bindTo: "query_form"
    service: null
    notes: |
      2026-02-11确定
      - Label宽度：120px
      - 组件宽度：240px（所有查询组件统一）
      - 包括：el-autocomplete、el-select、el-tree-select

  list_display_fields:
    intent: "列表页面字段显示优化：显示中文标签和名称，而非ID或代码"
    component:
      type: "custom"
      spec: |
        列表显示字段处理（2026-02-11完成）：

        1. 字典字段（使用 dict-tag 组件）：
           - 项目分类（projectCategory）: sys_xmfl
           - 项目阶段（projectStage）: sys_xmjd
           - 验收状态（acceptanceStatus）: sys_yszt
           - 审核状态（approvalStatus）: sys_spzt
           - 合同状态（contractStatus）: sys_htzt
           - 收入确认状态（revenueConfirmStatus）: sys_srqrzt

        2. 关联表字段（通过函数转换）：
           - 项目部门（projectDept）
             * 函数：getDeptName(deptId)
             * 显示：从第三级开始的完整路径，用'-'连接
             * 示例："事业部-开发部-研发组"
             * 数据源：deptFlatList（所有部门的扁平列表）

           - 项目经理（projectManagerId）
             * 函数：getUserName(userId, projectManagerList)
             * 显示：用户昵称
             * 数据源：projectManagerList（岗位为'pm'的用户）

           - 市场经理（marketManagerId）
             * 函数：getUserName(userId, marketManagerList)
             * 显示：用户昵称
             * 数据源：marketManagerList（岗位为'scjl'的用户）

           - 参与人员（participants）
             * 函数：getParticipantsNames(participants)
             * 显示：所有参与人员昵称，用逗号分隔
             * 数据源：allUsersList（所有用户列表）
             * 处理：将逗号分隔的ID字符串转为昵称数组，再join为字符串

        3. 初始化数据加载：
           - loadDeptTree() - 加载部门树和扁平列表
           - loadProjectManagers() - 加载项目经理列表
           - loadMarketManagers() - 加载市场经理列表
           - loadAllUsers() - 加载所有用户（用于参与人员显示）

        实现文件：index.vue
    bindTo: "list_display"
    service: null
    notes: |
      关键函数实现：
      - getDeptName(): 解析ancestors字段，构建从第三级开始的路径
      - getUserName(): 从用户列表中查找昵称
      - getParticipantsNames(): 将ID字符串转为昵称列表

      数据预加载：
      - 页面初始化时加载所有辅助数据
      - 避免列表渲染时频繁调用后端接口

  update_by_display:
    intent: "更新人显示用户昵称，如果 update_by 为空则显示 create_by 对应的昵称"
    component:
      type: "custom"
      spec: "列表显示字段，非表单组件"
    bindTo: "update_by"
    service: null
    notes: |
      1. 后端查询时关联 sys_user 表获取昵称
      2. SQL: LEFT JOIN sys_user u ON (t.update_by = u.user_name OR (t.update_by IS NULL AND t.create_by = u.user_name))
      3. 显示 u.nick_name

  approval_status_readonly:
    intent: "审核状态在编辑和详情页面只读回显，不可修改"
    component:
      type: "el-input"
      props:
        readonly: true
        disabled: true
    bindTo: "approval_status"
    service: null
    notes: |
      1. 审核状态由审核流程自动更新，用户不可手动修改
      2. 编辑页面和详情页面都只读显示
      3. 使用字典 sys_spzt 转换显示值

  approval_reason_readonly:
    intent: "审核意见在编辑和详情页面只读回显，不可修改"
    component:
      type: "el-input"
      props:
        type: "textarea"
        readonly: true
        disabled: true
        rows: 3
    bindTo: "approval_reason"
    service: null
    notes: "审核意见由审核人员填写，项目编辑时不可修改"

  list_summary_row:
    intent: "列表第一行添加合计行（在表头和第一行数据之间）"
    component:
      type: "custom"
      spec: |
        合计行位置：表头和第一行数据之间

        实现方式：
        - 在 getList() 中计算合计值
        - 创建合计行对象 { isSummaryRow: true, ... }
        - 插入到 projectList 数组第一位：[summaryRow, ...rows]
        - 模板中用 v-if="scope.row.isSummaryRow" 判断

        合计字段（保留两位小数）：
        - projectBudget - 项目预算
        - estimatedWorkload - 预估工作量
        - actualWorkload - 实际人天
        - contractAmount - 合同金额
        - confirmAmount - 确认金额

        显示规则：
        - 序号列显示"合计"（加粗）
        - 数值列显示合计值（加粗）
        - 其他列显示空白
        - 操作列不显示按钮
        - 选择框禁用：:selectable="checkSelectable"
    bindTo: ["projectBudget", "estimatedWorkload", "actualWorkload", "contractAmount", "confirmAmount"]
    service: null
    notes: |
      2026-02-11实现
      - 合计仅针对当前页数据，非全部数据
      - 背景色：#f5f7fa
      - 选择框过滤：handleSelectionChange 需过滤合计行

  list_extra_fields:
    intent: "列表显示关联表字段：合同金额和合同状态"
    component:
      type: "custom"
      spec: "列表显示字段，通过多表关联查询"
    bindTo: ["contract_amount", "contract_status"]
    service:
      endpoint: "列表查询接口内置关联查询"
      source: "ProjectMapper.selectProjectList"
      spec: |
        SQL 关联查询：
        LEFT JOIN pm_project_contract_rel pcr ON t.project_id = pcr.project_id
        LEFT JOIN pm_contract c ON pcr.contract_id = c.contract_id

        字段映射：
        - contract_amount: c.contract_amount
        - contract_status: c.contract_status (使用字典 sys_htzt 转换)
      newApi: false
    notes: |
      1. 一个项目可关联一个合同（通过 pm_project_contract_rel 中间表）
      2. 如果项目未关联合同，显示为空
      3. 合同状态使用字典 sys_htzt 转换显示

  list_operations:
    intent: "列表操作按钮：详情、编辑、添加合同、收入确认、附件、删除、打印"
    component:
      type: "custom"
      spec: |
        操作列按钮配置：
        1. 详情 - 跳转到 /project/project/detail/:id
        2. 编辑 - 跳转到 /project/project/edit/:id
        3. 添加合同 - 跳转到 /contract/contract/add?projectId=:id
        4. 收入确认 - 打开收入确认对话框（仅团队经理可见）
        5. 附件 - 打开附件管理对话框
        6. 删除 - 确认后删除项目
        7. 打印立项申请单 - 打开打印预览
    bindTo: "table_operations"
    service: null
    notes: |
      重要：列表不显示'新增'按钮！
      新增项目通过'立项申请'菜单(/project/apply)进入独立页面

  # ==================
  # 页面布局定制
  # ==================
  page_mode_independent:
    intent: "完全去掉 Dialog 弹窗模式，所有操作使用独立页面"
    component:
      type: "custom"
      spec: |
        页面模式：
        1. 列表页面：只显示列表、查询条件、操作按钮
        2. 新增操作：通过'立项申请'菜单进入 /project/apply 独立页面
        3. 编辑操作：点击'编辑'跳转到 /project/project/edit/:id 独立页面
        4. 详情操作：点击'详情'跳转到 /project/project/detail/:id 独立页面

        不使用 Dialog/Drawer 组件！
    bindTo: ["list_page", "edit_page", "detail_page", "apply_page"]
    service: null
    notes: |
      前端路由配置：
      - /project/project - 项目列表页面（list）
      - /project/apply - 立项申请页面（add，独立页面）
      - /project/project/edit/:id - 项目编辑页面（独立页面）
      - /project/project/detail/:id - 项目详情页面（独立页面）

  apply_page_layout:
    intent: "立项申请页面使用折叠 Card 布局，6 个模块（已移除收入确认模块）"
    component:
      type: "custom"
      spec: |
        布局：使用 el-card 组件，支持折叠/展开

        模块划分（共6个模块）：
        1. 项目基本信息
           - 行业、一级区域、二级区域、简称、立项年度、项目名称
           - 项目编号（自动生成，无格式提示）、项目分类、项目部门、项目阶段、验收状态
           - 预估工作量、项目预算、项目地址、项目计划、项目描述

        2. 人员配置
           - 项目经理、市场经理
           - 销售负责人、销售联系方式（自动带出）
           - 参与人员（多选）

        3. 客户信息
           - 客户名称、客户联系人、客户联系方式（自动带出）
           - 商户联系人、商户联系方式

        4. 时间规划
           - 启动日期、结束日期、投产日期、验收日期

        5. 成本预算
           - 项目费用、费用预算、成本预算
           - 人力费用、采购成本

        6. 备注
           - 备注信息

        注意：收入确认相关字段（revenueConfirmStatus, revenueConfirmYear, confirmAmount,
        taxRate, afterTaxAmount）已从编辑页面移除，但保留在数据库和实体类中，
        供其他模块使用（如公司收入确认列表）。
    bindTo: "apply_page"
    service: null
    notes: |
      使用 el-card 组件包裹每个模块，header 显示模块标题和折叠图标
      支持全部展开/全部折叠功能
      默认所有模块展开

      重要变更（2026-02-11）：
      - 移除了第7个模块（收入确认）
      - 项目编号字段不再显示格式说明文字
      - 立项年度使用字典 sys_ndgl

  edit_page_layout:
    intent: "项目编辑页面使用折叠 Card 布局，6 个模块（已移除收入确认模块）"
    component:
      type: "custom"
      spec: |
        同立项申请页面布局，但有以下区别：
        1. 项目编号字段只读不可修改
        2. 显示审核状态和审核意见（只读）
        3. 页面顶部显示"返回"按钮
        4. 底部显示"保存"和"取消"按钮
        5. 收入确认模块已移除（原第7个模块）

        模块划分（共6个模块）：
        1. 项目基本信息 - 包含项目编号（只读）、审核状态（只读）、审核意见（只读）
        2. 人员配置
        3. 客户信息
        4. 时间规划
        5. 成本预算
        6. 备注
    bindTo: "edit_page"
    service: null
    notes: |
      与立项申请页面的区别：
      1. 项目编号只读不可修改
      2. 显示审核状态和审核意见（只读）
      3. 页面顶部显示"返回"按钮
      4. 底部显示"保存"和"取消"按钮
      5. 已移除收入确认相关字段的编辑功能

      重要变更（2026-02-11）：
      - 去掉第7个模块（收入确认）
      - 收入确认字段仍保留在数据库中，但编辑页面不显示
      - 这些字段由专门的收入确认功能模块管理

  detail_page_layout:
    intent: "项目详情页面使用左右分栏布局：左侧项目详情（6个Card），右侧收入确认信息（1个Card）"
    component:
      type: "custom"
      spec: |
        布局：el-row + el-col (16, 8)

        左侧（16列宽）：
        - 项目详情，6个 Card 模块，与编辑页面结构相同
        - 所有字段只读显示
        - 关联数据显示名称而非ID：
          * 项目经理、市场经理、销售负责人 - 显示昵称
          * 客户名称、客户联系人 - 显示名称
          * 参与人员 - 以标签形式显示所有人员昵称

        右侧（8列宽）：
        - 收入确认信息 Card
        - 字段：收入确认状态、收入确认年度、确认金额（含税）、税后金额、税率
        - 只读显示，如果未确认则显示"-"
    bindTo: "detail_page"
    service: null
    notes: |
      页面顶部：
      - 返回列表按钮
      - 编辑按钮（跳转到编辑页面）
      - 打印立项申请单按钮

      名称回显实现（2026-02-11完成）：
      - 使用 loadRelatedNames() 函数加载关联数据的名称
      - 项目经理、市场经理、销售负责人：通过 /system/user/{userId} 获取昵称
      - 客户名称：通过 /project/customer/{customerId} 获取客户简称或全称
      - 客户联系人：通过 /project/customer/contact/listByCustomer 获取联系人名称和电话
      - 参与人员：加载所有用户后根据ID数组过滤并显示为标签

      实现文件：detail.vue
      关键函数：
      - loadRelatedNames(projectData) - 加载所有关联名称
      - loadCustomerContactPhone(customerId, contactId) - 加载客户联系人电话

  # ==================
  # 业务逻辑定制
  # ==================
  logical_delete_only:
    intent: "所有删除操作仅做逻辑删除，不做物理删除"
    component:
      type: "custom"
      spec: |
        删除标记：del_flag ('0'=正常, '1'=已删除)

        删除实现：
        - 使用 update 语句而非 delete
        - update pm_project set del_flag = '1' where project_id = #{projectId}

        查询过滤：
        - 所有查询添加 where del_flag = '0' 条件
    bindTo: "delete_operations"
    service: null
    notes: |
      2026-02-11实施
      优点：数据可恢复、保留历史记录、避免外键约束问题
      注意：del_flag 字段建议添加索引

  revenue_fields_removal:
    intent: "编辑页面移除收入确认模块，但数据库字段保留供其他模块使用"
    component:
      type: "custom"
      spec: |
        变更说明（2026-02-11）：

        移除的UI组件：
        - 编辑页面第7个面板（收入确认）
        - apply.vue 和 edit.vue 不再显示以下字段：
          * revenueConfirmStatus（收入确认状态）
          * revenueConfirmYear（收入确认年度）
          * confirmAmount（确认金额）
          * taxRate（税率）
          * afterTaxAmount（税后金额）

        移除的前端函数：
        - calculateAfterTaxAmount() - 税后金额自动计算函数

        保留的数据库字段（不删除）：
        - pm_project 表中上述字段仍然存在
        - Project.java 实体类保留这些字段
        - ProjectMapper.xml 保留字段映射

        原因：
        - 这些字段用于其他业务模块（如公司收入确认列表）
        - 项目编辑页面不需要管理收入确认数据
        - 收入确认由专门的确认流程管理

        影响范围：
        - 前端：apply.vue, edit.vue（移除面板和字段）
        - 后端：无变更（保持完整的字段定义）
        - 数据库：无变更（保持完整的表结构）
    bindTo: "revenue_fields"
    service: null
    notes: |
      重要：这不是字段删除，而是UI模块移除
      - 数据库和后端代码保持不变
      - 仅前端编辑页面不显示这些字段
      - 列表页面仍可显示这些字段（用于查询和统计）
      - 详情页面右侧仍显示收入确认信息

  tax_rate_logic:
    intent: "税率支持下拉选择和手动输入，根据项目分类自动带出默认值"
    component:
      type: "el-select"
      props:
        allow-create: true  # 支持手动输入自定义税率
        filterable: true
        clearable: true
        placeholder: "请选择或输入税率"
    bindTo: "tax_rate"
    service: null
    notes: |
      下拉选项：
      - 6% - 软件开发类
      - 13% - 硬件销售类

      逻辑：
      1. 监听 project_category 字段变化
      2. 如果选择"软件开发类"，自动填充 6%
      3. 如果选择"硬件销售类"，自动填充 13%
      4. 支持用户手动输入其他税率值

  after_tax_amount_calc:
    intent: "税后金额（不含税金额）自动计算"
    component:
      type: "el-input-number"
      props:
        readonly: true
        controls: false
        precision: 2
    bindTo: "after_tax_amount"
    service: null
    notes: |
      计算公式：税后金额 = 确认金额 / (1 + 税率)

      示例：
      - 确认金额：100元
      - 税率：6% (0.06)
      - 税后金额 = 100 / 1.06 = 94.34元

      监听字段：confirm_amount, tax_rate
      当任一字段变化时自动重新计算

  revenue_confirm_permission:
    intent: "收入确认权限控制：仅团队经理岗位可操作"
    component:
      type: "custom"
      spec: "权限控制，非 UI 组件"
    bindTo: "revenue_confirm_operation"
    service:
      endpoint: "POST /project/project/confirmRevenue"
      source: "ProjectService.confirmRevenue"
      params: ["projectId", "revenueConfirmStatus", "revenueConfirmYear", "confirmAmount", "taxRate"]
      returns: "操作结果"
      newApi: false
    notes: |
      权限要求：
      - 后端：使用 @PreAuthorize("@ss.hasRole('tdld')") 控制权限
      - 前端：使用 v-hasRole="['tdld']" 控制按钮显示
      - 岗位编码：tdld（团队负责人/团队经理）

      不需要审批流程，团队经理直接确认

  # ==================
  # 菜单和路由
  # ==================
  menu_structure:
    intent: "菜单结构：项目管理一级菜单，下设三个二级菜单"
    component:
      type: "custom"
      spec: |
        菜单结构：
        项目管理（一级菜单）
        ├── 立项申请（二级菜单，路由：/project/apply）
        ├── 立项审核（二级菜单，路由：/project/approval）
        └── 项目管理（二级菜单，路由：/project/project）
    bindTo: "menu"
    service: null
    notes: |
      重要：项目管理列表不显示'新增'按钮！
      新增项目通过'立项申请'菜单进入

  route_config:
    intent: "路由配置：添加三个独立页面路由"
    component:
      type: "custom"
      spec: |
        路由配置（在 router/index.js 中添加）：

        {
          path: '/project/apply',
          component: () => import('@/views/project/project/apply'),
          name: 'ProjectApply',
          meta: { title: '立项申请', activeMenu: '/project/project' }
        },
        {
          path: '/project/project/edit/:id',
          component: () => import('@/views/project/project/edit'),
          name: 'ProjectEdit',
          meta: { title: '编辑项目', activeMenu: '/project/project' }
        },
        {
          path: '/project/project/detail/:id',
          component: () => import('@/views/project/project/detail'),
          name: 'ProjectDetail',
          meta: { title: '项目详情', activeMenu: '/project/project' }
        }
    bindTo: "routes"
    service: null
    notes: |
      所有页面都是独立的全屏页面，不是 Dialog

  # ==================
  # 公司收入确认（客户化定制功能）
  # ==================
  revenue_confirmation:
    intent: "财务确认项目收入的定制功能模块"
    component:
      type: "custom"
      spec: |
        功能概述：
        公司收入确认是基于项目表的扩展功能模块，用于财务人员确认项目的收入金额。
        该功能使用项目表（pm_project）的收入确认相关字段，但有独立的列表页和详情页。

        涉及字段（pm_project表）：
        - revenue_confirm_status        收入确认状态（字典：sys_srqrzt）
        - revenue_confirm_year          收入确认年度（字典：sys_ndgl）
        - confirm_amount                确认金额（含税）BigDecimal
        - after_tax_amount              税后金额（不含税）BigDecimal
        - company_revenue_confirmed_by  公司收入确认人ID
        - company_revenue_confirmed_time 公司收入确认时间
        - tax_rate                      税率 BigDecimal

        路由配置：
        列表页：
        - 路径：/revenue/company
        - 组件：revenue/company/index.vue
        - 菜单：收入确认管理 > 公司收入确认

        详情页（动态路由）：
        - 路径：/revenue/company/detail/:projectId
        - 组件：revenue/company/detail.vue
        - 类型：隐藏路由，挂在一级菜单"收入确认管理"下
        - route_name: RevenueCompanyDetail
        - active_menu: /revenue/company

        后端接口（ProjectController）：
        - GET  /project/project/revenue/list         收入确认列表
        - GET  /project/project/revenue/{projectId}  收入确认详情
        - PUT  /project/project/revenue              保存收入确认
        - POST /project/project/revenue/export       导出收入确认数据

        业务规则：
        1. 收入确认状态自动设置
           - 点击"保存"按钮时，自动将 revenue_confirm_status 设置为 '1'（已确认）
           - 前端页面显示该字段，但设置为 disabled（只读）
           - 用户无法手动修改状态

        2. 税后金额自动计算
           - 公式：afterTaxAmount = confirmAmount / (1 + taxRate/100)
           - 触发时机：确认金额或税率变化时自动计算
           - 精度：保留两位小数

        3. 税率自动初始化
           - 根据项目分类（project_category）自动设置默认税率：
             * projectCategory === '1'（软件开发类）→ taxRate = 6%
             * projectCategory === '2'（硬件销售类）→ taxRate = 13%
           - 用户可以手动调整税率

        4. 列表页合计行
           - 在列表第一行显示合计数据
           - 合计字段：项目预算、预估工作量、实际人天、合同金额、确认金额、税后金额
           - 标识：isSummaryRow: true
           - 样式：字体加粗

        查询条件（与项目管理列表基本一致）：
        - 项目名称（autocomplete自动完成）
        - 项目部门（三级及以下机构，树形选择）
        - 收入确认年度（字典：sys_ndgl）
        - 项目分类（字典：sys_xmfl）
        - 一级区域（字典：sys_yjqy）
        - 二级区域（联动加载，filterable）
        - 项目经理（岗位：pm）
        - 市场经理（岗位：scjl）
        - 立项年度（字典：sys_ndgl）
        - 项目阶段（字典：sys_xmjd）
        - 审核状态（字典：sys_spzt）
        - 验收状态（字典：sys_yszt）
        - 收入确认状态（字典：sys_srqrzt）

        列表展示字段：
        - 项目名称、项目编码
        - 项目部门（显示完整路径：第三级-第四级-...）
        - 项目经理、市场经理（显示昵称）
        - 项目分类（字典标签）
        - 一级区域、二级区域（区域名称）
        - 项目阶段（字典标签）
        - 创建时间
        - 收入确认状态（字典标签）
        - 收入确认年度
        - 确认金额（含税）
        - 税后金额
        - 项目预算、预估工作量、实际人天、合同金额

        详情页布局（左右分栏）：
        左侧：项目详情信息（只读）
        - 项目基本信息（项目名称、编号、分类等）
        - 客户信息
        - 项目时间
        - 财务信息

        右侧：收入确认表单（可编辑）
        - 收入确认状态（只读显示）
        - 收入确认年度（必填）
        - 确认金额（含税）（必填）
        - 税率（必填，%）
        - 税后金额（自动计算，只读）

        操作按钮：
        列表页：
        - 收入确认：状态为"未确认"或空时显示，跳转到详情页编辑模式
        - 收入查看：状态为"已确认"时显示，跳转到详情页查看模式
        - 导出：导出当前查询结果

        详情页：
        - 保存：编辑模式下显示，保存后返回列表页
        - 编辑：查看模式下显示，切换到编辑模式
        - 取消/关闭：返回列表页

        前端实现细节：
        1. 列表页（revenue/company/index.vue）
           - 使用 getSecondaryRegions API 实现一级区域联动二级区域
           - 使用 getDeptTree API 加载三级及以下部门
           - 使用 getUsersByPost API 加载项目经理和市场经理
           - 项目名称使用 el-autocomplete 组件
           - 部门显示使用 getDeptName() 函数显示完整路径
           - 经理显示使用 getUserName() 函数显示昵称

        2. 详情页（revenue/company/detail.vue）
           - mode 参数：edit（编辑）| view（查看）
           - isViewMode 计算属性控制字段禁用状态
           - watch 监听 confirmAmount 和 taxRate 自动计算税后金额
           - submitForm 保存前自动设置 revenueConfirmStatus = '1'

        后端实现细节：
        1. ProjectMapper.xml
           - selectProjectList 添加 LEFT JOIN pm_secondary_region 获取区域名称
           - SELECT 子句添加 sr.region_name
           - ResultMap 添加 regionName 字段映射

        2. Project.java 实体类
           - 添加临时字段：private String regionName;
           - 添加 getter/setter 方法

        3. ProjectController
           - revenueList() 使用 selectProjectList 查询
           - getRevenueInfo() 查询单条项目详情
           - updateRevenue() 更新收入确认信息
           - exportRevenue() 导出收入确认数据

        菜单配置（pm-sql/init/02_menu_data.sql）：
        一级菜单：收入确认管理（menu_id: 2074）
        ├── 二级菜单：公司收入确认（menu_id: 2075）
        │   ├── 按钮：查询（revenue:company:query）
        │   ├── 按钮：查看（revenue:company:view）
        │   ├── 按钮：编辑（revenue:company:edit）
        │   └── 按钮：导出（revenue:company:export）
        └── 隐藏路由：收入确认详情（menu_id: 2080，挂在一级菜单下）
            - 路径：company/detail/:projectId(\\d+)
            - 组件：revenue/company/detail
            - route_name: RevenueCompanyDetail
            - active_menu: /revenue/company

        注意事项：
        1. 详情页路由必须挂在一级菜单（收入确认管理）下，不能挂在二级菜单下
        2. 使用动态路由从数据库加载，不要添加静态路由到 router/index.ts
        3. 二级区域联动必须使用 getSecondaryRegions API，响应为 response.data
        4. 部门下拉只显示三级及以下机构，但部门名称显示需要完整路径
        5. 收入确认状态字段在详情页显示但禁用，保存时自动设置

    bindTo: "revenue_confirmation_module"
    service: null
    notes: |
      这是一个完全定制化的业务功能模块，基于项目表但有独立的UI和业务逻辑。
      不要尝试通过代码生成工具生成，所有代码都是手工编写和定制的。

      与项目管理的关系：
      - 共享 pm_project 表
      - 共享查询条件和辅助API
      - 独立的菜单、路由和权限控制
      - 从项目管理列表也可以进入收入确认功能

      使用 activeMenu 属性使侧边栏高亮正确的菜单项
