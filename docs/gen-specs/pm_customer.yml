# ============================
# Tab 1: 基本信息
# ============================
basicInfo:
  tableName: pm_customer
  tableComment: 客户信息表
  className: Customer
  functionAuthor: ruoyi
  remark: ""

# ============================
# Tab 2: 字段信息
# ============================
columns:
  customer_id:
    columnComment: 客户主键ID
    columnType: bigint
    javaType: Long
    javaField: customerId
    isInsert: false
    isEdit: false
    isList: true
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""
  customer_simple_name:
    columnComment: 客户简称
    columnType: varchar(200)
    javaType: String
    javaField: customerSimpleName
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: LIKE
    isRequired: true
    htmlType: input
    dictType: ""
  customer_all_name:
    columnComment: 客户全称
    columnType: varchar(200)
    javaType: String
    javaField: customerAllName
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: LIKE
    isRequired: true
    htmlType: input
    dictType: ""
  industry:
    columnComment: 所属行业(字典表 字典类型industry)
    columnType: varchar(100)
    javaType: String
    javaField: industry
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: EQ
    isRequired: false
    htmlType: select
    dictType: "industry"
  region:
    columnComment: 所属区域(字典表 : 字典类型sys_yjqy)
    columnType: varchar(100)
    javaType: String
    javaField: region
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: EQ
    isRequired: false
    htmlType: select
    dictType: "sys_yjqy"
  sales_manager_id:
    columnComment: 销售负责人ID
    columnType: bigint
    javaType: Long
    javaField: salesManagerId
    isInsert: true
    isEdit: true
    isList: false
    isQuery: true
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""
  sales_manager_name:
    columnComment: 销售负责人姓名
    columnType: varchar(100)
    javaType: String
    javaField: salesManagerName
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: LIKE
    isRequired: false
    htmlType: input
    dictType: ""
  office_address:
    columnComment: 办公地址
    columnType: varchar(500)
    javaType: String
    javaField: officeAddress
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: textarea
    dictType: ""
  del_flag:
    columnComment: 删除标志(0正常 1删除)
    columnType: char(1)
    javaType: String
    javaField: delFlag
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""
  create_by:
    columnComment: 创建者
    columnType: varchar(64)
    javaType: String
    javaField: createBy
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""
  create_time:
    columnComment: 创建时间
    columnType: datetime
    javaType: Date
    javaField: createTime
    isInsert: false
    isEdit: false
    isList: true
    isQuery: true
    queryType: EQ
    isRequired: false
    htmlType: datetime
    dictType: ""
  update_by:
    columnComment: 更新者
    columnType: varchar(64)
    javaType: String
    javaField: updateBy
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""
  update_time:
    columnComment: 更新时间
    columnType: datetime
    javaType: Date
    javaField: updateTime
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: datetime
    dictType: ""
  remark:
    columnComment: 备注
    columnType: varchar(500)
    javaType: String
    javaField: remark
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: textarea
    dictType: ""

# ============================
# Tab 3: 生成信息
# ============================
genInfo:
  tplCategory: sub
  tplWebType: element-plus
  packageName: com.ruoyi.project
  moduleName: project
  businessName: customer
  functionName: 客户管理
  parentMenuId: 3
  subTableName: pm_customer_contact
  subTableFkName: customer_id

# ============================
# 子表字段信息 (pm_customer_contact)
# ============================
subColumns:
  contact_id:
    columnComment: 联系人主键ID
    columnType: bigint
    javaType: Long
    javaField: contactId
    isInsert: false
    isEdit: false
    isList: true
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""
  customer_id:
    columnComment: 客户ID
    columnType: bigint
    javaType: Long
    javaField: customerId
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: true
    htmlType: input
    dictType: ""
  contact_name:
    columnComment: 联系人姓名
    columnType: varchar(100)
    javaType: String
    javaField: contactName
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: LIKE
    isRequired: true
    htmlType: input
    dictType: ""
  contact_phone:
    columnComment: 联系人电话
    columnType: varchar(50)
    javaType: String
    javaField: contactPhone
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: LIKE
    isRequired: true
    htmlType: input
    dictType: ""
  contact_tag:
    columnComment: 联系人标签(字典表，字典类型contact_tag)
    columnType: varchar(100)
    javaType: String
    javaField: contactTag
    isInsert: true
    isEdit: true
    isList: true
    isQuery: true
    queryType: EQ
    isRequired: true
    htmlType: select
    dictType: "contact_tag"
  del_flag:
    columnComment: 删除标志(0正常 1删除)
    columnType: char(1)
    javaType: String
    javaField: delFlag
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""
  create_by:
    columnComment: 创建者
    columnType: varchar(64)
    javaType: String
    javaField: createBy
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""
  create_time:
    columnComment: 创建时间
    columnType: datetime
    javaType: Date
    javaField: createTime
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: datetime
    dictType: ""
  update_by:
    columnComment: 更新者
    columnType: varchar(64)
    javaType: String
    javaField: updateBy
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: input
    dictType: ""
  update_time:
    columnComment: 更新时间
    columnType: datetime
    javaType: Date
    javaField: updateTime
    isInsert: false
    isEdit: false
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: datetime
    dictType: ""
  remark:
    columnComment: 备注
    columnType: varchar(500)
    javaType: String
    javaField: remark
    isInsert: true
    isEdit: true
    isList: false
    isQuery: false
    queryType: EQ
    isRequired: false
    htmlType: textarea
    dictType: ""

# ============================
# 自定义 UI（超出标准9种显示类型的需求）
# ============================
customizations:
  # 查询表单增强
  queryFormEnhancements:
    - field: customerSimpleName
      component: el-autocomplete
      description: 客户简称使用自动补全组件，支持模糊搜索历史客户简称
      implementation: |
        使用 el-autocomplete 替代普通 input
        fetch-suggestions 绑定到 querySimpleNameSearch 方法
        从当前客户列表中提取唯一的客户简称作为建议列表

    - field: customerAllName
      component: el-autocomplete
      description: 客户全称使用自动补全组件，支持模糊搜索历史客户全称
      implementation: |
        使用 el-autocomplete 替代普通 input
        fetch-suggestions 绑定到 queryAllNameSearch 方法
        从当前客户列表中提取唯一的客户全称作为建议列表

  # 主子表联动编辑
  subTableInlineEdit:
    description: 在客户编辑对话框中内嵌联系人表格，支持动态添加/删除联系人
    features:
      - 在表单中使用 el-divider 分隔主表和子表信息
      - 子表使用 el-table 展示，每行可编辑
      - 提供"添加联系人"按钮动态增加行
      - 每行提供"删除"按钮移除联系人
      - 子表字段直接在表格单元格中使用表单组件（input/select）
    implementation: |
      <el-divider content-position="left">联系人信息</el-divider>
      <el-button @click="handleAddContact">添加联系人</el-button>
      <el-table :data="form.contactList">
        <el-table-column label="联系人姓名">
          <template #default="scope">
            <el-input v-model="scope.row.contactName" />
          </template>
        </el-table-column>
        <!-- 其他列类似 -->
      </el-table>

  # 表单验证增强
  customValidation:
    - field: contactPhone
      description: 联系人电话号码自定义验证，支持手机号和座机号两种格式
      rules:
        - 手机号格式：1开头的11位数字 (正则：/^1[3-9]\d{9}$/)
        - 座机号格式：区号-号码 或 号码（支持分机号）(正则：/^(0\d{2,3}-?)?\d{7,8}(-\d{1,6})?$/)
      implementation: |
        在 submitForm 中手动验证所有联系人的电话号码
        遍历 form.contactList，对每个 contact.contactPhone 进行正则校验
        如果格式不正确，使用 proxy.$modal.msgError 提示用户

  # 数据展示优化
  displayEnhancements:
    - field: createTime
      description: 创建时间在列表中格式化显示为 YYYY-MM-DD
      implementation: |
        使用 parseTime 工具函数格式化
        <span>{{ parseTime(scope.row.createTime, '{y}-{m}-{d}') }}</span>

    - field: industry
      description: 所属行业在列表中使用字典标签组件显示
      implementation: |
        <dict-tag :options="industry" :value="scope.row.industry"/>

    - field: region
      description: 所属区域在列表中使用字典标签组件显示
      implementation: |
        <dict-tag :options="sys_yjqy" :value="scope.row.region"/>

  # 业务逻辑特性
  businessLogic:
    - feature: 主子表级联保存
      description: 新增/修改客户时，同时保存客户基本信息和联系人列表
      implementation: |
        form.contactList 作为客户对象的属性一起提交
        后端 Service 层使用事务处理主子表的插入/更新/删除

    - feature: 主子表级联删除
      description: 删除客户时，自动删除该客户下的所有联系人（通过 del_flag 软删除）
      implementation: |
        后端 Service 层在删除客户时，同时更新关联联系人的 del_flag

    - feature: 主子表级联查询
      description: 查询客户详情时，自动加载该客户的所有联系人
      implementation: |
        Mapper XML 中使用 collection 标签配置一对多关联查询
        或在 Service 层分别查询客户和联系人后组装

  # 权限控制
  permissions:
    - project:customer:list - 查询客户列表
    - project:customer:query - 查询客户详情
    - project:customer:add - 新增客户
    - project:customer:edit - 修改客户
    - project:customer:remove - 删除客户
    - project:customer:export - 导出客户数据

  # 操作日志
  operationLog:
    - action: INSERT
      title: 客户管理
      description: 新增客户时记录操作日志
    - action: UPDATE
      title: 客户管理
      description: 修改客户时记录操作日志
    - action: DELETE
      title: 客户管理
      description: 删除客户时记录操作日志
    - action: EXPORT
      title: 客户管理
      description: 导出客户数据时记录操作日志

  # Excel 导入导出
  excelSupport:
    description: 支持客户数据的 Excel 导出功能
    exportFields:
      - 客户主键ID (customerId)
      - 客户简称 (customerSimpleName)
      - 客户全称 (customerAllName)
      - 所属行业 (industry)
      - 所属区域 (region)
      - 销售负责人姓名 (salesManagerName)
    implementation: |
      使用 @Excel 注解标记需要导出的字段
      Controller 中使用 ExcelUtil 工具类导出
      导出文件名格式：customer_{timestamp}.xlsx

# ============================
# 原始 DDL
# ============================
ddl: |
  CREATE TABLE `pm_customer` (
    `customer_id` bigint NOT NULL AUTO_INCREMENT COMMENT '客户主键ID',
    `customer_simple_name` varchar(200) NOT NULL COMMENT '客户简称',
    `customer_all_name` varchar(200) NOT NULL COMMENT '客户全称',
    `industry` varchar(100) DEFAULT NULL COMMENT '所属行业(字典表 字典类型industry)',
    `region` varchar(100) DEFAULT NULL COMMENT '所属区域(字典表 : 字典类型sys_yjqy)',
    `sales_manager_id` bigint DEFAULT NULL COMMENT '销售负责人ID',
    `sales_manager_name` varchar(100) DEFAULT NULL COMMENT '销售负责人姓名',
    `office_address` varchar(500) DEFAULT NULL COMMENT '办公地址',
    `del_flag` char(1) DEFAULT '0' COMMENT '删除标志(0正常 1删除)',
    `create_by` varchar(64) DEFAULT NULL COMMENT '创建者',
    `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_by` varchar(64) DEFAULT NULL COMMENT '更新者',
    `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `remark` varchar(500) DEFAULT NULL COMMENT '备注',
    PRIMARY KEY (`customer_id`),
    KEY `idx_sales_manager_id` (`sales_manager_id`),
    KEY `idx_create_time` (`create_time`)
  ) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='客户信息表';

  CREATE TABLE `pm_customer_contact` (
    `contact_id` bigint NOT NULL AUTO_INCREMENT COMMENT '联系人主键ID',
    `customer_id` bigint NOT NULL COMMENT '客户ID',
    `contact_name` varchar(100) NOT NULL COMMENT '联系人姓名',
    `contact_phone` varchar(50) NOT NULL COMMENT '联系人电话',
    `contact_tag` varchar(100) NOT NULL COMMENT '联系人标签(字典表，字典类型contact_tag)',
    `del_flag` char(1) DEFAULT '0' COMMENT '删除标志(0正常 1删除)',
    `create_by` varchar(64) DEFAULT NULL COMMENT '创建者',
    `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_by` varchar(64) DEFAULT NULL COMMENT '更新者',
    `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `remark` varchar(500) DEFAULT NULL COMMENT '备注',
    PRIMARY KEY (`contact_id`),
    KEY `idx_customer_id` (`customer_id`),
    KEY `idx_create_time` (`create_time`)
  ) ENGINE=InnoDB AUTO_INCREMENT=18 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='客户联系人表';