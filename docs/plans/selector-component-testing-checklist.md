# 选择器组件迁移测试清单

> **测试时间：** 2026-02-12
> **测试范围：** 已迁移的2个页面
> **测试环境：**
> - 前端：http://localhost:83/
> - 后端：http://localhost:8080/

---

## 📋 测试页面

1. ✅ `/project/review`（项目审核）
2. ✅ `/revenue/company`（公司收入确认）

---

## 🧪 测试步骤

### 页面1：项目审核 `/project/review`

#### 1.1 访问页面
```
URL: http://localhost:83/project/review
默认账号: admin / admin123
```

#### 1.2 选择器功能测试

**测试1：项目分类选择器（DictSelect）**
- [ ] 点击"项目分类"选择器
- [ ] 验证：下拉列表显示字典选项（软件开发类、硬件销售类等）
- [ ] 选择一个选项
- [ ] 验证：选择框显示已选值
- [ ] 点击清空按钮（×）
- [ ] 验证：选择框清空

**测试2：一级区域选择器（DictSelect）**
- [ ] 点击"一级区域"选择器
- [ ] 验证：下拉列表显示区域选项
- [ ] 选择一个区域（如：华北）
- [ ] 验证：选择框显示已选值

**测试3：二级区域选择器（SecondaryRegionSelect）**
- [ ] 初始状态：验证二级区域选择器被禁用（灰色）
- [ ] 选择一级区域后
  - [ ] 验证：二级区域选择器自动启用
  - [ ] 点击二级区域选择器
  - [ ] 验证：下拉列表显示对应的省份/城市
  - [ ] 选择一个二级区域
  - [ ] 验证：选择框显示已选值
- [ ] 清空一级区域
  - [ ] 验证：二级区域选择器自动清空并禁用

**测试4：项目经理选择器（UserSelect）**
- [ ] 点击"项目经理"选择器
- [ ] 验证：下拉列表显示用户列表（应该是项目经理岗位的用户）
- [ ] 在搜索框输入用户名
- [ ] 验证：列表自动过滤匹配的用户
- [ ] 选择一个用户
- [ ] 验证：选择框显示已选用户昵称

**测试5：市场经理选择器（UserSelect）**
- [ ] 点击"市场经理"选择器
- [ ] 验证：下拉列表显示用户列表（应该是市场经理岗位的用户）
- [ ] 选择一个用户
- [ ] 验证：选择框显示已选用户昵称

**测试6：审核状态选择器（DictSelect）**
- [ ] 点击"审核状态"选择器
- [ ] 验证：下拉列表显示审核状态选项（待审核、已通过、已拒绝）
- [ ] 选择一个状态
- [ ] 验证：选择框显示已选值

#### 1.3 综合功能测试

**测试7：搜索功能**
- [ ] 选择多个筛选条件（项目分类、区域、经理、审核状态）
- [ ] 点击"搜索"按钮
- [ ] 验证：表格数据根据条件正确筛选
- [ ] 打开浏览器开发者工具（F12）→ Network 标签
- [ ] 验证：API请求 `/project/review/list` 包含正确的查询参数

**测试8：重置功能**
- [ ] 设置多个筛选条件
- [ ] 点击"重置"按钮
- [ ] 验证：所有选择器清空（除了"审核状态"默认为"待审核"）
- [ ] 验证：表格重新加载默认数据

**测试9：表格数据展示**
- [ ] 验证：表格正确显示项目列表
- [ ] 验证：表格中的"项目分类"、"项目阶段"、"审核状态"使用字典标签显示（DictTag）
- [ ] 验证：表格中的"项目经理"、"市场经理"显示用户昵称

#### 1.4 控制台检查

- [ ] 打开浏览器开发者工具（F12）→ Console 标签
- [ ] 验证：无 JavaScript 错误（红色）
- [ ] 验证：无警告信息（黄色）
- [ ] 切换到 Network 标签
- [ ] 验证：API请求正常，无404或500错误

---

### 页面2：公司收入确认 `/revenue/company`

#### 2.1 访问页面
```
URL: http://localhost:83/revenue/company
```

#### 2.2 选择器功能测试

该页面有**11个选择器**，逐一测试：

**测试1：收入确认年度（DictSelect）**
- [ ] 点击选择器
- [ ] 验证：显示年度列表
- [ ] 选择一个年度
- [ ] 验证：选中成功

**测试2：项目分类（DictSelect）**
- [ ] 点击选择器
- [ ] 验证：显示项目分类列表
- [ ] 选择一个分类
- [ ] 验证：选中成功

**测试3：一级区域 + 二级区域联动（DictSelect + SecondaryRegionSelect）**
- [ ] 验证：初始状态二级区域被禁用
- [ ] 选择一级区域
- [ ] 验证：二级区域自动启用并加载数据
- [ ] 选择二级区域
- [ ] 验证：选中成功
- [ ] 清空一级区域
- [ ] 验证：二级区域自动清空并禁用

**测试4：项目经理（UserSelect - 带 ref）**
- [ ] 点击选择器
- [ ] 验证：显示项目经理列表
- [ ] 在搜索框输入用户名
- [ ] 验证：列表自动过滤
- [ ] 选择一个用户
- [ ] 验证：选中成功

**测试5：市场经理（UserSelect - 带 ref）**
- [ ] 点击选择器
- [ ] 验证：显示市场经理列表
- [ ] 选择一个用户
- [ ] 验证：选中成功

**测试6-11：其他字典选择器**
- [ ] 立项年度（DictSelect）
- [ ] 项目阶段（DictSelect）
- [ ] 审核状态（DictSelect）
- [ ] 验收状态（DictSelect）
- [ ] 收入确认状态（DictSelect）

**逐一验证：**
- [ ] 点击能正常打开下拉列表
- [ ] 选项正确显示
- [ ] 能够正常选择和清空

#### 2.3 表格数据展示测试（重要！）

**测试12：用户名显示（通过 ref 访问）**
- [ ] 设置筛选条件并搜索，确保表格有数据
- [ ] 查看表格中的"项目经理"列
  - [ ] 验证：显示用户昵称（不是 userId）
  - [ ] 验证：不显示 "-" 或空白（如果有项目经理）
- [ ] 查看表格中的"市场经理"列
  - [ ] 验证：显示用户昵称（不是 userId）
  - [ ] 验证：不显示 "-" 或空白（如果有市场经理）

**这是关键测试点！** 因为这个页面使用了 ref 访问 UserSelect 组件的数据。

#### 2.4 综合功能测试

**测试13：多条件搜索**
- [ ] 同时设置多个筛选条件（年度、分类、区域、经理、状态）
- [ ] 点击"搜索"按钮
- [ ] 验证：表格数据根据条件正确筛选
- [ ] 验证：合计行正确计算

**测试14：重置功能**
- [ ] 设置多个筛选条件
- [ ] 点击"重置"按钮
- [ ] 验证：所有选择器清空
- [ ] 验证：表格重新加载默认数据

**测试15：导出功能**
- [ ] 点击"导出"按钮
- [ ] 验证：能够正常下载 Excel 文件
- [ ] 打开 Excel 文件
- [ ] 验证：数据正确

#### 2.5 控制台检查

- [ ] 打开浏览器开发者工具（F12）→ Console 标签
- [ ] 验证：无 JavaScript 错误（特别注意 ref 相关错误）
- [ ] 验证：无警告信息
- [ ] 切换到 Network 标签
- [ ] 验证：用户列表 API 只调用一次（不重复加载）
- [ ] 验证：二级区域 API 只在选择一级区域后调用

---

## 🔍 特别关注点

### 1. 二级区域联动（最容易出问题）
- ✅ 初始禁用状态
- ✅ 选择一级区域后自动启用
- ✅ 清空一级区域后自动清空并禁用
- ✅ 一级区域变化时，二级区域选择自动清空

### 2. 用户列表加载（按岗位筛选）
- ✅ 项目经理选择器只显示项目经理
- ✅ 市场经理选择器只显示市场经理
- ✅ 不显示所有用户

### 3. 字典数据加载
- ✅ 字典选择器能够正确显示字典选项
- ✅ 不显示字典 key（如 '1', '2'），而是显示字典 label（如 '软件开发类'）

### 4. 表格数据显示（company 页面）
- ✅ 项目经理、市场经理列显示用户昵称
- ✅ 不显示 "undefined" 或空白
- ✅ 使用 ref 访问组件数据的方式正常工作

---

## 🐛 常见问题排查

### 问题1：选择器无法打开或无选项
**排查：**
1. 打开 Console 查看是否有 JavaScript 错误
2. 打开 Network 查看 API 请求是否成功
3. 检查字典类型是否正确（dict-type）

### 问题2：二级区域不联动
**排查：**
1. 检查 regionDictValue 绑定是否正确
2. 查看 Console 是否有错误
3. 验证一级区域选择后，Network 是否有二级区域 API 请求

### 问题3：表格显示 undefined 或空白
**排查：**
1. 检查 ref 是否正确设置
2. 查看 Console 错误
3. 验证 UserSelect 组件是否正确加载数据

### 问题4：编译错误或警告
**排查：**
1. 检查组件导入路径是否正确
2. 检查 props 命名是否正确（kebab-case vs camelCase）
3. 查看完整的编译日志

---

## ✅ 测试完成标准

### 必须项（全部通过才算成功）
- [ ] 页面1（项目审核）所有选择器功能正常
- [ ] 页面2（公司收入确认）所有选择器功能正常
- [ ] 二级区域联动功能正常
- [ ] 表格数据正确显示（特别是 company 页面的用户名）
- [ ] 无 Console 错误
- [ ] 搜索、重置功能正常
- [ ] 数据筛选正确

### 可选项（建议测试）
- [ ] 导出功能正常
- [ ] 性能正常（无明显卡顿）
- [ ] 多次切换选择器无问题

---

## 📝 测试记录

测试完成后，请记录：

**测试结果：** ✅ 通过 / ❌ 失败

**发现的问题：**
1.
2.
3.

**Console 错误（如有）：**
```
复制粘贴错误信息
```

**建议改进：**
1.
2.

---

## 🎯 下一步

**如果测试通过：**
- ✅ 继续迁移剩余3个页面
- ✅ 完成后进行完整回归测试

**如果测试失败：**
- 🔧 修复发现的问题
- 🔄 重新测试
- 📝 更新组件代码

---

**测试人员：** _______________
**测试日期：** 2026-02-12
**测试耗时：** ___________ 分钟

---

*本测试清单由 Claude Code 自动生成*
